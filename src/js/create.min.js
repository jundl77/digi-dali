/**
 * True if the image has been uploaded, else false
 *
 * @type {boolean}
 */
function isUploaded(){return uploaded}function isVideoOn(){return videoOn}function isFindingEdges(){return edgeDetection}function isVectorizing(){return vectorizing}function isVectorized(){return vectorized}function disabler(event){return event.preventDefault(),!1}function refreshEdgeSliders(){$("#sigmaSlider").removeClass("disabled"),$("#kernelSlider").removeClass("disabled"),$("#t1Slider").removeClass("disabled"),$("#t2Slider").removeClass("disabled"),$("#sigmaTxt").prop("disabled",!1),$("#kernelTxt").prop("disabled",!1),$("#t1Txt").prop("disabled",!1),$("#t2Txt").prop("disabled",!1);var newValue=document.getElementById("sigmaTxt").value;$("#sigmaSlider").foundation("slider","set_value",newValue);var newValue=document.getElementById("kernelTxt").value;$("#kernelSlider").foundation("slider","set_value",newValue);var newValue=document.getElementById("t1Txt").value;$("#t1Slider").foundation("slider","set_value",newValue);var newValue=document.getElementById("t2Txt").value;$("#t2Slider").foundation("slider","set_value",newValue)}function refreshVectorSliders(){$("#vSlopeSlider").removeClass("disabled"),$("#vRadiusSlider").removeClass("disabled"),$("#vSlopeTxt").prop("disabled",!1),$("#vRadiusTxt").prop("disabled",!1),$("#vEndPtCheckBox").prop("disabled",!1);var newValue=document.getElementById("vSlopeTxt").value;$("#vSlopeSlider").foundation("slider","set_value",newValue);var newValue=document.getElementById("vRadiusTxt").value;$("#vRadiusSlider").foundation("slider","set_value",newValue),$("#vEndPtCheckBox").attr("checked",!1),$("#vEndPtCheckBox").attr("checked",!0)}function activateFindEdges(){$("#edgeCollapseDiv").collapse("show"),edgeCollapsed=!1,edgeCollapsed||vectorCollapsed||$("#canvasBlock").animate({height:"44.5em","padding-top":"4em"},300),refreshEdgeSliders(),canCollapseEdge=!0,uploaded=!0,$("#statusP").text(""),$("#statusDiv").css("background-color","transparent"),$("#statusDiv").css("border","0px solid #E3E3E3"),$("#downloadFormInfo").hide(400),$("#orderFormInfo").hide(400),$("#selfieButtonImg").attr("src","images/Create/selfie-button-normal.png"),$("#pictureBox").css("background-image","none"),$("#pictureBox").css("background-color","white"),(!videoOn||videoAboutToStop)&&findEdgeMain()}function activateVectorizeAndDownload(){edgesFound===!1&&($("#vectorCollapseDiv").collapse("show"),$("#edgeCollapseDiv").collapse("hide"),vectorCollapsed=!1,edgeCollapsed=!0,edgeCollapsed||vectorCollapsed||$("#canvasBlock").animate({height:"44.5em","padding-top":"4em"},300),$("#downloadButton").fadeTo("fast",.3,function(){$(this).css("border","2px solid #FF5252"),$("#downloadButtonImg").attr("src","images/Create/download-normal.png")}).fadeTo("fast",1),refreshVectorSliders(),canCollapseVector=!0,edgesFound=!0,vectorizeMain())}function deactivateVectorizeAndDownload(){edgesFound===!0&&($("#downloadButton").fadeTo("fast",.3,function(){$(this).css("border","2px solid #7B7B7B"),$("#downloadButtonImg").attr("src","images/Create/download-disabled.png")}).fadeTo("fast",1),$("#vSlopeSlider").addClass("disabled"),$("#vRadiusSlider").addClass("disabled"),$("#vSlopeTxt").prop("disabled",!0),$("#vRadiusTxt").prop("disabled",!0),$("#vEndPtCheckBox").prop("disabled",!0),$("#vectorCollapseDiv").collapse("hide"),vectorCollapsed=!0,(edgeCollapsed||vectorCollapsed)&&$("#canvasBlock").animate({height:"37em","padding-top":"0em"},300),canCollapseVector=!1,edgesFound=!1)}function activateLaserButton(){vectorized===!1&&($("#laserButton").fadeTo("fast",.3,function(){$(this).css("border","2px solid #FF5252"),$("#laserButtonImg").attr("src","images/Create/laser-normal.png")}).fadeTo("fast",1),vectorized=!0)}function deactivateLaserButton(){vectorized===!0&&($("#laserButton").fadeTo("fast",.3,function(){$(this).css("border","2px solid #7B7B7B"),$("#laserButtonImg").attr("src","images/Create/laser-disabled.png")}).fadeTo("fast",1),vectorized=!1)}function dragenterDragleave(e){e.preventDefault(),dragCount+="dragenter"===e.type?1:-1,"dragenter"===e.type?grayOut():dragCount%2===0&&removeGrayOut()}function grayOut(){var screen=document.createElement("div");screen.id="screen",document.body.appendChild(screen),$("#screen").css({position:"absolute",left:0,top:0,"background-color":"#000000",opacity:.5,width:$(document).width(),height:$(document).height(),"z-index":99}),$("body").css({overflow:"hidden"})}function removeGrayOut(){$("#screen").remove(),$("body").css({overflow:"visible"})}function stopVideo(){if(videoOn){var mediaStreamTrack=mediaStream.getTracks();mediaStreamTrack[0].stop()}videoOn=!1,videoStopped=!0}var uploaded=!1,edgesFound=!1,vectorized=!1,firstVectorInfo=!0,firstSubmitInfo=!0,canCollapseEdge=!1,canCollapseVector=!1,edgeCollapsed=!0,vectorCollapsed=!0,dragCount=0,videoOn=!1,mediaStream=null,videoAboutToStop=!1,videoStopped=!1,edgeDetection=!1,vectorizing=!1,edgeButtonPressed=!1,vectorButtonPressed=!1;$(document).ready(function(){$(document).foundation(),$(function(){$('[data-toggle="popover"]').popover()}),Dropzone.autoDiscover=!1;var dropzone=new Dropzone("canvas#pictureBox",{url:"/file/post",autoProcessQueue:!1,maxFilesize:5,acceptedFiles:"image/*"});dropzone.on("addedfile",function(file){stopVideo();var reader=new FileReader;reader.onload=function(theFile){return function(e){setPictureOnCanvasDROP("pictureBox",e.target.result)}}(file),reader.readAsDataURL(file)}),document.addEventListener("dragenter",dragenterDragleave),document.addEventListener("dragleave",dragenterDragleave),dropzone.on("drop",function(event){removeGrayOut()}),dropzone.on("dragenter",function(event){dragCount++,grayOut()});var canvas=document.getElementById("pictureBox"),ctx=canvas.getContext("2d"),video=document.getElementById("videoElement"),videoFrame=null;video.addEventListener("play",function(){var $this=this;videoFrame=$("#videoElement").get(0),ctx.clearRect(0,0,canvas.width,canvas.height);var offWidth,offHeight,width,height;videoFrame.videoWidth>videoFrame.videoHeight?(offWidth=0,width=canvas.width,height=parseInt(canvas.height*(videoFrame.videoHeight/videoFrame.videoWidth),10),offHeight=parseInt((canvas.height-height)/2,10)):(offHeight=0,height=canvas.height,width=parseInt(canvas.width*(videoFrame.videoWidth/videoFrame.videoHeight),10),offWidth=parseInt((canvas.width-width)/2,10)),function loop(){if(!$this.paused&&!$this.ended&&!videoStopped){var canvasTemp=getCanvasTemp();canvasTemp.width=canvas.width,canvasTemp.height=canvas.height;var ctxTemp=canvasTemp.getContext("2d");ctxTemp.drawImage($this,offWidth,offHeight,width,height);var imageData=ctxTemp.getImageData(offWidth,offHeight,width,height);if(videoAboutToStop){var img=setImgDataToImg(imageData);stopVideo(),setImageInit(img),activateFindEdges(),activateVectorizeAndDownload(),videoAboutToStop=!1}for(var sigma=21-parseFloat(document.getElementById("sigmaTxt").value),kernelSize=21-parseInt(document.getElementById("kernelTxt").value),edgeT1=201-parseFloat(document.getElementById("t1Txt").value),edgeT2=201-parseFloat(document.getElementById("t2Txt").value),edgeImgData=applyEdgeDetection(imageData,!0,!1,!0,sigma,kernelSize,edgeT1,edgeT2),y=0;y<edgeImgData.height;y++)for(var x=0;x<edgeImgData.width;x++){var color=getPixel(edgeImgData,x,y);255==color[0]&&255==color[1]&&255==color[2]?setPixel(edgeImgData,x,y,50,50,50,255):setPixel(edgeImgData,x,y,255,255,255,255)}setEdgeImageData(edgeImgData);var edgeImg=setImgDataToImg(edgeImgData);setPictureOnCanvas("pictureBox",edgeImg.getAttribute("src")),setTimeout(loop,20)}}()},0),document.getElementById("sigmaTxt").defaultValue="19",document.getElementById("kernelTxt").defaultValue="10",document.getElementById("t1Txt").defaultValue="135",document.getElementById("t2Txt").defaultValue="170",document.getElementById("vSlopeTxt").defaultValue="0.3",document.getElementById("vRadiusTxt").defaultValue="5",$("#sigmaTxt").prop("disabled",!0),$("#kernelTxt").prop("disabled",!0),$("#t1Txt").prop("disabled",!0),$("#t2Txt").prop("disabled",!0),$("#vSlopeTxt").prop("disabled",!0),$("#vRadiusTxt").prop("disabled",!0),$("#vEndPtCheckBox").prop("disabled",!0);var sigmaValue=19;$("#sigmaSlider").foundation("slider","set_value",sigmaValue);var kernelValue=10;$("#kernelSlider").foundation("slider","set_value",kernelValue);var t1Value=135;$("#t1Slider").foundation("slider","set_value",t1Value);var t2Value=170;$("#t2Slider").foundation("slider","set_value",t2Value);var vSlopeValue=4.8;$("#vSlopeSlider").foundation("slider","set_value",vSlopeValue);var vRadiusValue=16;$("#vRadiusSlider").foundation("slider","set_value",vRadiusValue),$("#edgeCollapse").css("cursor","default"),$("#vectorCollapse").css("cursor","default"),$("#edgeCollapse").mouseenter(function(){canCollapseEdge?($(this).css("cursor","pointer"),$(this).unbind("click",disabler),$(this).css("color","#FF5252"),$("#edgeDetectionLine").css("border-bottom","1px solid #FF5252")):($(this).css("cursor","default"),$(this).bind("click",disabler))}),$("#edgeCollapse").mouseleave(function(){$(this).css("cursor","default"),$(this).bind("click",disabler),$(this).css("color","#000000"),$("#edgeDetectionLine").css("border-bottom","1px solid #C8C8C8")}),$("#edgeCollapse").click(function(){canCollapseEdge&&($("#edgeCollapseDiv").collapse("show"),edgeCollapsed=!edgeCollapsed,edgeCollapsed||vectorCollapsed?$("#canvasBlock").animate({height:"37em","padding-top":"0em"},300):$("#canvasBlock").animate({height:"49.5em","padding-top":"4em"},300),refreshEdgeSliders())}),$("#vectorCollapse").mouseenter(function(){canCollapseVector?($(this).css("cursor","pointer"),$(this).unbind("click",disabler),$(this).css("color","#FF5252"),$("#vectorizationLine").css("border-bottom","1px solid #FF5252")):($(this).css("cursor","default"),$(this).bind("click",disabler))}),$("#vectorCollapse").mouseleave(function(){$(this).css("cursor","default"),$(this).bind("click",disabler),$(this).css("color","#000000"),$("#vectorizationLine").css("border-bottom","1px solid #C8C8C8")}),$("#vectorCollapse").click(function(){canCollapseVector&&($("#vectorCollapseDiv").collapse("show"),vectorCollapsed=!vectorCollapsed,edgeCollapsed||vectorCollapsed?$("#canvasBlock").animate({height:"37em","padding-top":"0em"},300):$("#canvasBlock").animate({height:"49.5em","padding-top":"4em"},300),refreshVectorSliders())}),$("#sigmaSlider").on("change.fndtn.slider",function(){var newVal=$("#sigmaSlider").attr("data-slider");document.getElementById("sigmaTxt").value=newVal.toString()}),$("#kernelSlider").on("change.fndtn.slider",function(){var newVal=$("#kernelSlider").attr("data-slider");document.getElementById("kernelTxt").value=newVal.toString()}),$("#t1Slider").on("change.fndtn.slider",function(){var newVal=$("#t1Slider").attr("data-slider");document.getElementById("t1Txt").value=newVal.toString()}),$("#t2Slider").on("change.fndtn.slider",function(){var newVal=$("#t2Slider").attr("data-slider");document.getElementById("t2Txt").value=newVal.toString()}),$("#vSlopeSlider").on("change.fndtn.slider",function(){var newVal=$("#vSlopeSlider").attr("data-slider");document.getElementById("vSlopeTxt").value=newVal.toString()}),$("#vRadiusSlider").on("change.fndtn.slider",function(){var newVal=$("#vRadiusSlider").attr("data-slider");document.getElementById("vRadiusTxt").value=newVal.toString()}),$("#sigmaTxt").change(function(){var newValue=document.getElementById("sigmaTxt").value;newValue>=1&&20>=newValue&&$("#sigmaSlider").foundation("slider","set_value",newValue)}),$("#kernelTxt").change(function(){var newValue=document.getElementById("kernelTxt").value;newValue>=1&&20>=newValue&&$("#kernelSlider").foundation("slider","set_value",newValue)}),$("#t1Txt").change(function(){var newValue=document.getElementById("t1Txt").value;newValue>=1&&200>=newValue&&$("#t1Slider").foundation("slider","set_value",newValue)}),$("#t2Txt").change(function(){var newValue=document.getElementById("t2Txt").value;newValue>=1&&200>=newValue&&$("#t2Slider").foundation("slider","set_value",newValue)}),$("#vSlopeTxt").change(function(){var newValue=document.getElementById("vSlopeTxt").value;newValue>=0&&5>=newValue&&$("#vSlopeSlider").foundation("slider","set_value",newValue)}),$("#vRadiusTxt").change(function(){var newValue=document.getElementById("vRadiusTxt").value;newValue>=2&&20>=newValue&&$("#vRadiusSlider").foundation("slider","set_value",newValue)}),$("#edgeButton").mousedown(function(){edgeButtonPressed||videoOn?videoOn||($(this).css("background-color","#E5E5E5"),edgeDetection=!1):($(this).css("background-color","#C1C1C1"),edgeDetection=!0),vectorizing=!1,vectorButtonPressed=!1,$("#vectorButton").css("background-color","#E5E5E5"),edgeButtonPressed=!edgeButtonPressed}),$("#edgeButton").mouseenter(function(){videoOn||$(this).css("cursor","pointer")}),$("#edgeButton").mouseleave(function(){$(this).css("cursor","default")}),$("#vectorButton").mousedown(function(){vectorButtonPressed?($(this).css("background-color","#E5E5E5"),vectorizing=!1):($(this).css("background-color","#C1C1C1"),vectorizing=!0),edgeDetection=!1,edgeButtonPressed=!1,$("#edgeButton").css("background-color","#E5E5E5"),vectorButtonPressed=!vectorButtonPressed}),$("#vectorButton").mouseenter(function(){$(this).css("cursor","pointer")}),$("#vectorButton").mouseleave(function(){$(this).css("cursor","default")}),$("#topBarLogo").mouseenter(function(){$(this).addClass("tossing")}),$("#topBarLogo").mouseleave(function(){$(this).removeClass("tossing")}),$("#menuItem1").mouseenter(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#262626")}).fadeTo(50,1)}),$("#menuItem1").mouseleave(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#F9F9F9")}).fadeTo(50,1)}),$("#menuItem2").mouseenter(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#262626")}).fadeTo(50,1)}),$("#menuItem2").mouseleave(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#F9F9F9")}).fadeTo(50,1)}),$("#menuItem3").mouseenter(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#262626")}).fadeTo(50,1)}),$("#menuItem3").mouseleave(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#F9F9F9")}).fadeTo(50,1)}),$("#menuItem4").mouseenter(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#262626")}).fadeTo(50,1)}),$("#menuItem4").mouseleave(function(){$(this).fadeTo(50,.3,function(){$(this).css("color","#F9F9F9")}).fadeTo(50,1)});var stripePaymentHandler=StripeCheckout.configure({key:"pk_test_JUVZX1AXxjeWpTkpEYqSDEwH",image:"",token:function(token,args){submitPayment(token,args)}});$("#selfieButton").click(function(){function handleVideo(stream){mediaStream=stream,video.src=window.URL.createObjectURL(stream),$("#selfieButton").fadeTo(100,.7,function(){$(this).css("border","2px solid #FF5252"),$("#selfieButtonImg").attr("src","images/Create/selfie-button-hover.png")}).fadeTo(100,1),videoOn=!0,videoAboutToStop=!1,activateFindEdges(),deactivateVectorizeAndDownload(),deactivateLaserButton()}function videoError(e){videoOn=!1}if(videoOn)null!==mediaStream&&(videoAboutToStop=!0,$("#edgeButton").css("border","1px solid #FF5252"),$("#edgeButtonText").css("color","#FF5252"));else{var video=document.querySelector("#videoElement");videoStopped=!1,$("#edgeButton").css("border","1px solid #C8C8C8"),$("#edgeButtonText").css("color","#C8C8C8"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:!0},handleVideo,videoError)}}),$("#selfieButton").mouseenter(function(){$(this).css("cursor","pointer"),videoOn?$(this).fadeTo(100,.7,function(){$(this).css("border","2px solid #FF5252"),$("#selfieButtonImg").attr("src","images/Create/selfie-button-clicked.png")}).fadeTo(100,1):$(this).fadeTo(100,.7,function(){$(this).css("border","2px solid #FF5252"),$("#selfieButtonImg").attr("src","images/Create/selfie-button-hover.png")}).fadeTo(100,1)}),$("#selfieButton").mouseleave(function(){$(this).css("cursor","default"),videoOn?$(this).fadeTo(100,.7,function(){$(this).css("border","2px solid #FF5252"),$("#selfieButtonImg").attr("src","images/Create/selfie-button-hover.png")}).fadeTo(100,1):$(this).fadeTo(100,.7,function(){$(this).css("border","2px solid #262626"),$("#selfieButtonImg").attr("src","images/Create/selfie-button-normal.png")}).fadeTo(100,1)}),$("#downloadButton").click(function(){if(edgesFound)$("#downloadModal").foundation("reveal","open");else{if($("#downloadPopover").popover("show"),$("#downloadDiv div.popover").css("opacity","0"),$("#downloadDiv div.popover").css("height","6em"),$("#downloadDiv div.popover").fadeTo("slow",1),firstVectorInfo){var crossDiv=document.createElement("div");crossDiv.id="download-info-popover-close-cross",$("#downloadDiv div.popover").append(crossDiv),firstVectorInfo=!1}$("#download-info-popover-close-cross").click(function(){$("#downloadDiv div.popover").css("opacity","1"),$("#downloadDiv div.popover").fadeTo("slow",0,function(){$("#downloadPopover").popover("hide")})})}}),$("#downloadButton").mouseenter(function(){edgesFound&&($(this).css("cursor","pointer"),$(this).fadeTo("fast",.3,function(){$(this).css("border","2px solid #262626"),$("#downloadButtonImg").attr("src","images/Create/download-hover.png")}).fadeTo("fast",1))}),$("#downloadButton").mouseleave(function(){edgesFound&&($(this).css("cursor","default"),$(this).fadeTo("fast",.3,function(){$(this).css("border","2px solid #FF5252"),$("#downloadButtonImg").attr("src","images/Create/download-normal.png")}).fadeTo("fast",1))}),$("#downloadModalButtonFree").mouseenter(function(){$(this).css("cursor","pointer")}),$("#downloadModalButtonFree").mouseleave(function(){$(this).css("cursor","default")}),$("#downloadModalButtonFree").mousedown(function(){$(this).css("background-color","#E5E5E5"),download()}),$("#downloadModalButtonFree").mouseup(function(){$(this).css("background-color","transparent")}),$("#downloadModalButtonCost1").mouseenter(function(){$(this).css("cursor","pointer")}),$("#downloadModalButtonCost1").mouseleave(function(){$(this).css("cursor","default")}),$("#downloadModalButtonCost1").mousedown(function(){$(this).css("background-color","#E5E5E5")}),$("#downloadModalButtonCost1").mouseup(function(){$(this).css("background-color","transparent")}),$("#downloadModalButtonCost1").on("click",function(e){openStripeBox(50,null,e)}),$("#downloadModalButtonCost2").mouseenter(function(){$(this).css("cursor","pointer")}),$("#downloadModalButtonCost2").mouseleave(function(){$(this).css("cursor","default")}),$("#downloadModalButtonCost2").mousedown(function(){$(this).css("background-color","#E5E5E5")}),$("#downloadModalButtonCost2").mouseup(function(){$(this).css("background-color","transparent")}),$("#downloadModalButtonCost2").on("click",function(e){openStripeBox(100,null,e)}),$("#laserDiv").click(function(){if(vectorized)$("#laserModal").foundation("reveal","open");else{if($("#laserPopover").popover("show"),$("#laserDiv div.popover").css("opacity","0"),$("#laserDiv div.popover").fadeTo("slow",1),firstSubmitInfo){var crossDiv=document.createElement("div");crossDiv.id="laser-info-popover-close-cross",$("#laserDiv div.popover").append(crossDiv),firstSubmitInfo=!1}$("#laser-info-popover-close-cross").click(function(){$("#laserDiv div.popover").css("opacity","1"),$("#laserDiv div.popover").fadeTo("slow",0,function(){$("#laserPopover").popover("hide")})})}}),$("#laserDiv").mouseenter(function(){vectorized&&($(this).css("cursor","pointer"),$("#laserButton").fadeTo("fast",.7,function(){$(this).css("border","2px solid #262626"),$("#laserButtonImg").attr("src","images/Create/laser-hover.png")}).fadeTo("fast",1))}),$("#laserDiv").mouseleave(function(){vectorized&&($(this).css("cursor","default"),$("#laserButton").fadeTo("fast",.7,function(){$(this).css("border","2px solid #FF5252"),$("#laserButtonImg").attr("src","images/Create/laser-normal.png")}).fadeTo("fast",1))}),$("#stripeCheckoutButton").mousedown(function(){$(this).css("background-color","#E5E5E5")}),$("#stripeCheckoutButton").mouseup(function(){$(this).css("background-color","transparent")}),$("#stripeCheckoutButton").mouseenter(function(){$(this).css("cursor","pointer")}),$("#stripeCheckoutButton").mouseleave(function(){$(this).css("cursor","default")}),$("#laserModalButton").mousedown(function(){$(this).css("background-color","#E5E5E5"),validateGiftCode(document.getElementById("laserGiftCardInput").value)}),$("#laserModalButton").mouseup(function(){$(this).css("background-color","transparent")}),$("#laserModalButton").mouseenter(function(){$(this).css("cursor","pointer")}),$("#laserModalButton").mouseleave(function(){$(this).css("cursor","default")}),$("#stripeCheckoutButton").on("click",function(e){var data=generateUploadArray();return data===!1?!1:void openStripeBox(1e3,document.getElementById("laserFormEmailInput").value,e)});var openStripeBox=function(amount,email,event){setAmount(amount),stripePaymentHandler.open({image:"images/logo.png",name:"Digi Dali",description:"1 laser engraving",currency:"eur",amount:amount,email:email,allowRememberMe:!1}),event.preventDefault()};$(window).on("popstate",function(){stripePaymentHandler.close()})});