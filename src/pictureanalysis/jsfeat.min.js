/**
 The MIT License

 Copyright (c) 2012 Eugene Zatepyakin

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */
var jsfeat=jsfeat||{REVISION:"ALPHA"};!function(global){"use strict";var EPSILON=1.192092896e-7,FLT_MIN=1e-37,U8_t=256,S32_t=512,F32_t=1024,S64_t=2048,F64_t=4096,C1_t=1,C2_t=2,C3_t=3,C4_t=4,_data_type_size=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),get_data_type=function(){return function(type){return 65280&type}}(),get_channel=function(){return function(type){return 255&type}}(),get_data_type_size=function(){return function(type){return _data_type_size[(65280&type)>>8]}}(),COLOR_RGBA2GRAY=0,COLOR_RGB2GRAY=1,COLOR_BGRA2GRAY=2,COLOR_BGR2GRAY=3,BOX_BLUR_NOSCALE=1,SVD_U_T=1,SVD_V_T=2,data_t=function(){function data_t(size_in_bytes,buffer){this.size=-8&(size_in_bytes+7|0),"undefined"==typeof buffer?this.buffer=new ArrayBuffer(this.size):(this.buffer=buffer,this.size=buffer.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return data_t}(),matrix_t=function(){function matrix_t(c,r,data_type,data_buffer){this.type=0|get_data_type(data_type),this.channel=0|get_channel(data_type),this.cols=0|c,this.rows=0|r,"undefined"==typeof data_buffer?this.allocate():(this.buffer=data_buffer,this.data=this.type&U8_t?this.buffer.u8:this.type&S32_t?this.buffer.i32:this.type&F32_t?this.buffer.f32:this.buffer.f64)}return matrix_t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new data_t(this.cols*get_data_type_size(this.type)*this.channel*this.rows),this.data=this.type&U8_t?this.buffer.u8:this.type&S32_t?this.buffer.i32:this.type&F32_t?this.buffer.f32:this.buffer.f64},matrix_t.prototype.copy_to=function(other){for(var od=other.data,td=this.data,i=0,n=this.cols*this.rows*this.channel|0;n-4>i;i+=4)od[i]=td[i],od[i+1]=td[i+1],od[i+2]=td[i+2],od[i+3]=td[i+3];for(;n>i;++i)od[i]=td[i]},matrix_t.prototype.resize=function(c,r,ch){"undefined"==typeof ch&&(ch=this.channel);var new_size=c*get_data_type_size(this.type)*ch*r;new_size>this.buffer.size?(this.cols=c,this.rows=r,this.channel=ch,this.allocate()):(this.cols=c,this.rows=r,this.channel=ch)},matrix_t}(),pyramid_t=function(){function pyramid_t(levels){this.levels=0|levels,this.data=new Array(levels),this.pyrdown=jsfeat.imgproc.pyrdown}return pyramid_t.prototype.allocate=function(start_w,start_h,data_type){for(var i=this.levels;--i>=0;)this.data[i]=new matrix_t(start_w>>i,start_h>>i,data_type)},pyramid_t.prototype.build=function(input,skip_first_level){"undefined"==typeof skip_first_level&&(skip_first_level=!0);var i=2,a=input,b=this.data[0];if(!skip_first_level)for(var j=input.cols*input.rows;--j>=0;)b.data[j]=input.data[j];for(b=this.data[1],this.pyrdown(a,b);i<this.levels;++i)a=b,b=this.data[i],this.pyrdown(a,b)},pyramid_t}(),keypoint_t=function(){function keypoint_t(x,y,score,level,angle){"undefined"==typeof x&&(x=0),"undefined"==typeof y&&(y=0),"undefined"==typeof score&&(score=0),"undefined"==typeof level&&(level=0),"undefined"==typeof angle&&(angle=-1),this.x=x,this.y=y,this.score=score,this.level=level,this.angle=angle}return keypoint_t}();global.U8_t=U8_t,global.S32_t=S32_t,global.F32_t=F32_t,global.S64_t=S64_t,global.F64_t=F64_t,global.C1_t=C1_t,global.C2_t=C2_t,global.C3_t=C3_t,global.C4_t=C4_t,global.U8C1_t=U8_t|C1_t,global.U8C3_t=U8_t|C3_t,global.U8C4_t=U8_t|C4_t,global.F32C1_t=F32_t|C1_t,global.F32C2_t=F32_t|C2_t,global.S32C1_t=S32_t|C1_t,global.S32C2_t=S32_t|C2_t,global.EPSILON=EPSILON,global.FLT_MIN=FLT_MIN,global.COLOR_RGBA2GRAY=COLOR_RGBA2GRAY,global.COLOR_RGB2GRAY=COLOR_RGB2GRAY,global.COLOR_BGRA2GRAY=COLOR_BGRA2GRAY,global.COLOR_BGR2GRAY=COLOR_BGR2GRAY,global.BOX_BLUR_NOSCALE=BOX_BLUR_NOSCALE,global.SVD_U_T=SVD_U_T,global.SVD_V_T=SVD_V_T,global.get_data_type=get_data_type,global.get_channel=get_channel,global.get_data_type_size=get_data_type_size,global.data_t=data_t,global.matrix_t=matrix_t,global.pyramid_t=pyramid_t,global.keypoint_t=keypoint_t}(jsfeat),function(global){"use strict";var cache=function(){var _pool_head,_pool_tail,_pool_node_t=function(){function _pool_node_t(size_in_bytes){this.next=null,this.data=new jsfeat.data_t(size_in_bytes),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return _pool_node_t.prototype.resize=function(size_in_bytes){delete this.data,this.data=new jsfeat.data_t(size_in_bytes),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},_pool_node_t}(),_pool_size=0;return{allocate:function(capacity,data_size){_pool_head=_pool_tail=new _pool_node_t(data_size);for(var i=0;capacity>i;++i){var node=new _pool_node_t(data_size);_pool_tail=_pool_tail.next=node,_pool_size++}},get_buffer:function(size_in_bytes){var node=_pool_head;return _pool_head=_pool_head.next,_pool_size--,size_in_bytes>node.size&&node.resize(size_in_bytes),node},put_buffer:function(node){_pool_tail=_pool_tail.next=node,_pool_size++}}}();global.cache=cache,cache.allocate(30,2560)}(jsfeat),function(global){"use strict";var math=function(){var qsort_stack=new Int32Array(96);return{get_gaussian_kernel:function(size,sigma,kernel,data_type){var i=0,x=0,t=0,sigma_x=0,scale_2x=0,sum=0,kern_node=jsfeat.cache.get_buffer(size<<2),_kernel=kern_node.f32;if(1==(1&size)&&7>=size&&0>=sigma)switch(size>>1){case 0:_kernel[0]=1,sum=1;break;case 1:_kernel[0]=.25,_kernel[1]=.5,_kernel[2]=.25,sum=1;break;case 2:_kernel[0]=.0625,_kernel[1]=.25,_kernel[2]=.375,_kernel[3]=.25,_kernel[4]=.0625,sum=1;break;case 3:_kernel[0]=.03125,_kernel[1]=.109375,_kernel[2]=.21875,_kernel[3]=.28125,_kernel[4]=.21875,_kernel[5]=.109375,_kernel[6]=.03125,sum=1}else for(sigma_x=sigma>0?sigma:.3*(.5*(size-1)-1)+.8,scale_2x=-.5/(sigma_x*sigma_x);size>i;++i)x=i-.5*(size-1),t=Math.exp(scale_2x*x*x),_kernel[i]=t,sum+=t;if(data_type&jsfeat.U8_t)for(sum=256/sum,i=0;size>i;++i)kernel[i]=_kernel[i]*sum+.5|0;else for(sum=1/sum,i=0;size>i;++i)kernel[i]=_kernel[i]*sum;jsfeat.cache.put_buffer(kern_node)},perspective_4point_transform:function(model,src_x0,src_y0,dst_x0,dst_y0,src_x1,src_y1,dst_x1,dst_y1,src_x2,src_y2,dst_x2,dst_y2,src_x3,src_y3,dst_x3,dst_y3){var t1=src_x0,t2=src_x2,t4=src_y1,t5=t1*t2*t4,t6=src_y3,t7=t1*t6,t8=t2*t7,t9=src_y2,t10=t1*t9,t11=src_x1,t14=src_y0,t15=src_x3,t16=t14*t15,t18=t16*t11,t20=t15*t11*t9,t21=t15*t4,t24=t15*t9,t25=t2*t4,t26=t6*t2,t27=t6*t11,t28=t9*t11,t30=1/(t21-t24-t25+t26-t27+t28),t32=t1*t15,t35=t14*t11,t41=t4*t1,t42=t6*t41,t43=t14*t2,t46=t16*t9,t48=t14*t9*t11,t51=t4*t6*t2,t55=t6*t14,Hr0=-(t8-t5+t10*t11-t11*t7-t16*t2+t18-t20+t21*t2)*t30,Hr1=(t5-t8-t32*t4+t32*t9+t18-t2*t35+t27*t2-t20)*t30,Hr2=t1,Hr3=(-t9*t7+t42+t43*t4-t16*t4+t46-t48+t27*t9-t51)*t30,Hr4=(-t42+t41*t9-t55*t2+t46-t48+t55*t11+t51-t21*t9)*t30,Hr5=t14,Hr6=(-t10+t41+t43-t35+t24-t21-t26+t27)*t30,Hr7=(-t7+t10+t16-t43+t27-t28-t21+t25)*t30;t1=dst_x0,t2=dst_x2,t4=dst_y1,t5=t1*t2*t4,t6=dst_y3,t7=t1*t6,t8=t2*t7,t9=dst_y2,t10=t1*t9,t11=dst_x1,t14=dst_y0,t15=dst_x3,t16=t14*t15,t18=t16*t11,t20=t15*t11*t9,t21=t15*t4,t24=t15*t9,t25=t2*t4,t26=t6*t2,t27=t6*t11,t28=t9*t11,t30=1/(t21-t24-t25+t26-t27+t28),t32=t1*t15,t35=t14*t11,t41=t4*t1,t42=t6*t41,t43=t14*t2,t46=t16*t9,t48=t14*t9*t11,t51=t4*t6*t2,t55=t6*t14;var Hl0=-(t8-t5+t10*t11-t11*t7-t16*t2+t18-t20+t21*t2)*t30,Hl1=(t5-t8-t32*t4+t32*t9+t18-t2*t35+t27*t2-t20)*t30,Hl2=t1,Hl3=(-t9*t7+t42+t43*t4-t16*t4+t46-t48+t27*t9-t51)*t30,Hl4=(-t42+t41*t9-t55*t2+t46-t48+t55*t11+t51-t21*t9)*t30,Hl5=t14,Hl6=(-t10+t41+t43-t35+t24-t21-t26+t27)*t30,Hl7=(-t7+t10+t16-t43+t27-t28-t21+t25)*t30;t2=Hr4-Hr7*Hr5,t4=Hr0*Hr4,t5=Hr0*Hr5,t7=Hr3*Hr1,t8=Hr2*Hr3,t10=Hr1*Hr6;var t12=Hr2*Hr6;t15=1/(t4-t5*Hr7-t7+t8*Hr7+t10*Hr5-t12*Hr4),t18=-Hr3+Hr5*Hr6;var t23=-Hr3*Hr7+Hr4*Hr6;t28=-Hr1+Hr2*Hr7;var t31=Hr0-t12;t35=Hr0*Hr7-t10,t41=-Hr1*Hr5+Hr2*Hr4;var t44=t5-t8,t47=t4-t7;t48=t2*t15;var t49=t28*t15,t50=t41*t15,mat=model.data;mat[0]=Hl0*t48+Hl1*(t18*t15)-Hl2*(t23*t15),mat[1]=Hl0*t49+Hl1*(t31*t15)-Hl2*(t35*t15),mat[2]=-Hl0*t50-Hl1*(t44*t15)+Hl2*(t47*t15),mat[3]=Hl3*t48+Hl4*(t18*t15)-Hl5*(t23*t15),mat[4]=Hl3*t49+Hl4*(t31*t15)-Hl5*(t35*t15),mat[5]=-Hl3*t50-Hl4*(t44*t15)+Hl5*(t47*t15),mat[6]=Hl6*t48+Hl7*(t18*t15)-t23*t15,mat[7]=Hl6*t49+Hl7*(t31*t15)-t35*t15,mat[8]=-Hl6*t50-Hl7*(t44*t15)+t47*t15},qsort:function(array,low,high,cmp){var t,ta,tb,tc,isort_thresh=7,sp=0,left=0,right=0,i=0,n=0,m=0,ptr=0,ptr2=0,d=0,left0=0,left1=0,right0=0,right1=0,pivot=0,a=0,b=0,c=0,swap_cnt=0,stack=qsort_stack;if(!(1>=high-low+1))for(stack[0]=low,stack[1]=high;sp>=0;)for(left=stack[sp<<1],right=stack[(sp<<1)+1],sp--;;){if(n=right-left+1,isort_thresh>=n){for(ptr=left+1;right>=ptr;ptr++)for(ptr2=ptr;ptr2>left&&cmp(array[ptr2],array[ptr2-1]);ptr2--)t=array[ptr2],array[ptr2]=array[ptr2-1],array[ptr2-1]=t;break}for(swap_cnt=0,left0=left,right0=right,pivot=left+(n>>1),n>40&&(d=n>>3,a=left,b=left+d,c=left+(d<<1),ta=array[a],tb=array[b],tc=array[c],left=cmp(ta,tb)?cmp(tb,tc)?b:cmp(ta,tc)?c:a:cmp(tc,tb)?b:cmp(ta,tc)?a:c,a=pivot-d,b=pivot,c=pivot+d,ta=array[a],tb=array[b],tc=array[c],pivot=cmp(ta,tb)?cmp(tb,tc)?b:cmp(ta,tc)?c:a:cmp(tc,tb)?b:cmp(ta,tc)?a:c,a=right-(d<<1),b=right-d,c=right,ta=array[a],tb=array[b],tc=array[c],right=cmp(ta,tb)?cmp(tb,tc)?b:cmp(ta,tc)?c:a:cmp(tc,tb)?b:cmp(ta,tc)?a:c),a=left,b=pivot,c=right,ta=array[a],tb=array[b],tc=array[c],pivot=cmp(ta,tb)?cmp(tb,tc)?b:cmp(ta,tc)?c:a:cmp(tc,tb)?b:cmp(ta,tc)?a:c,pivot!=left0&&(t=array[pivot],array[pivot]=array[left0],array[left0]=t,pivot=left0),left=left1=left0+1,right=right1=right0,ta=array[pivot];;){for(;right>=left&&!cmp(ta,array[left]);)cmp(array[left],ta)||(left>left1&&(t=array[left1],array[left1]=array[left],array[left]=t),swap_cnt=1,left1++),left++;for(;right>=left&&!cmp(array[right],ta);)cmp(ta,array[right])||(right1>right&&(t=array[right1],array[right1]=array[right],array[right]=t),swap_cnt=1,right1--),right--;if(left>right)break;t=array[left],array[left]=array[right],array[right]=t,swap_cnt=1,left++,right--}if(0==swap_cnt){for(left=left0,right=right0,ptr=left+1;right>=ptr;ptr++)for(ptr2=ptr;ptr2>left&&cmp(array[ptr2],array[ptr2-1]);ptr2--)t=array[ptr2],array[ptr2]=array[ptr2-1],array[ptr2-1]=t;break}for(n=Math.min(left1-left0,left-left1),m=left-n|0,i=0;n>i;++i,++m)t=array[left0+i],array[left0+i]=array[m],array[m]=t;for(n=Math.min(right0-right1,right1-right),m=right0-n+1|0,i=0;n>i;++i,++m)t=array[left+i],array[left+i]=array[m],array[m]=t;if(n=left-left1,m=right1-right,n>1)m>1?n>m?(++sp,stack[sp<<1]=left0,stack[(sp<<1)+1]=left0+n-1,left=right0-m+1,right=right0):(++sp,stack[sp<<1]=right0-m+1,stack[(sp<<1)+1]=right0,left=left0,right=left0+n-1):(left=left0,right=left0+n-1);else{if(!(m>1))break;left=right0-m+1,right=right0}}},median:function(array,low,high){for(var w,middle=0,ll=0,hh=0,median=low+high>>1;;){if(low>=high)return array[median];if(high==low+1)return array[low]>array[high]&&(w=array[low],array[low]=array[high],array[high]=w),array[median];for(middle=low+high>>1,array[middle]>array[high]&&(w=array[middle],array[middle]=array[high],array[high]=w),array[low]>array[high]&&(w=array[low],array[low]=array[high],array[high]=w),array[middle]>array[low]&&(w=array[middle],array[middle]=array[low],array[low]=w),ll=low+1,w=array[middle],array[middle]=array[ll],array[ll]=w,hh=high;;){do++ll;while(array[low]>array[ll]);do--hh;while(array[hh]>array[low]);if(ll>hh)break;w=array[ll],array[ll]=array[hh],array[hh]=w}w=array[low],array[low]=array[hh],array[hh]=w,median>=hh?low=ll:hh>=median&&(high=hh-1)}return 0}}}();global.math=math}(jsfeat),function(global){"use strict";var matmath=function(){return{identity:function(M,value){"undefined"==typeof value&&(value=1);for(var src=M.data,rows=M.rows,cols=M.cols,cols_1=cols+1|0,len=rows*cols,k=len;--len>=0;)src[len]=0;for(len=k,k=0;len>k;)src[k]=value,k+=cols_1},transpose:function(At,A){for(var i=0,j=0,nrows=A.rows,ncols=A.cols,Ai=0,Ati=0,pAt=0,ad=A.data,atd=At.data;nrows>i;Ati+=1,Ai+=ncols,i++)for(pAt=Ati,j=0;ncols>j;pAt+=nrows,j++)atd[pAt]=ad[Ai+j]},multiply:function(C,A,B){for(var i=0,j=0,k=0,Ap=0,pA=0,pB=0,p_B=0,Cp=0,ncols=A.cols,nrows=A.rows,mcols=B.cols,ad=A.data,bd=B.data,cd=C.data,sum=0;nrows>i;Ap+=ncols,i++)for(p_B=0,j=0;mcols>j;Cp++,p_B++,j++){for(pB=p_B,pA=Ap,sum=0,k=0;ncols>k;pA++,pB+=mcols,k++)sum+=ad[pA]*bd[pB];cd[Cp]=sum}},multiply_ABt:function(C,A,B){for(var i=0,j=0,k=0,Ap=0,pA=0,pB=0,Cp=0,ncols=A.cols,nrows=A.rows,mrows=B.rows,ad=A.data,bd=B.data,cd=C.data,sum=0;nrows>i;Ap+=ncols,i++)for(pB=0,j=0;mrows>j;Cp++,j++){for(pA=Ap,sum=0,k=0;ncols>k;pA++,pB++,k++)sum+=ad[pA]*bd[pB];cd[Cp]=sum}},multiply_AtB:function(C,A,B){for(var i=0,j=0,k=0,Ap=0,pA=0,pB=0,p_B=0,Cp=0,ncols=A.cols,nrows=A.rows,mcols=B.cols,ad=A.data,bd=B.data,cd=C.data,sum=0;ncols>i;Ap++,i++)for(p_B=0,j=0;mcols>j;Cp++,p_B++,j++){for(pB=p_B,pA=Ap,sum=0,k=0;nrows>k;pA+=ncols,pB+=mcols,k++)sum+=ad[pA]*bd[pB];cd[Cp]=sum}},multiply_AAt:function(C,A){for(var i=0,j=0,k=0,pCdiag=0,p_A=0,pA=0,pB=0,pC=0,pCt=0,ncols=A.cols,nrows=A.rows,ad=A.data,cd=C.data,sum=0;nrows>i;pCdiag+=nrows+1,p_A=pA,i++)for(pC=pCdiag,pCt=pCdiag,pB=p_A,j=i;nrows>j;pC++,pCt+=nrows,j++){for(pA=p_A,sum=0,k=0;ncols>k;k++)sum+=ad[pA++]*ad[pB++];cd[pC]=sum,cd[pCt]=sum}},multiply_AtA:function(C,A){for(var i=0,j=0,k=0,p_A=0,pA=0,pB=0,p_C=0,pC=0,p_CC=0,ncols=A.cols,nrows=A.rows,ad=A.data,cd=C.data,sum=0;ncols>i;p_C+=ncols,i++)for(p_A=i,p_CC=p_C+i,pC=p_CC,j=i;ncols>j;pC++,p_CC+=ncols,j++){for(pA=p_A,pB=j,sum=0,k=0;nrows>k;pA+=ncols,pB+=ncols,k++)sum+=ad[pA]*ad[pB];cd[pC]=sum,cd[p_CC]=sum}},identity_3x3:function(M,value){"undefined"==typeof value&&(value=1);var dt=M.data;dt[0]=dt[4]=dt[8]=value,dt[1]=dt[2]=dt[3]=0,dt[5]=dt[6]=dt[7]=0},invert_3x3:function(from,to){var A=from.data,invA=to.data,t1=A[4],t2=A[8],t4=A[5],t5=A[7],t8=A[0],t9=t8*t1,t11=t8*t4,t13=A[3],t14=A[1],t15=t13*t14,t17=A[2],t18=t13*t17,t20=A[6],t21=t20*t14,t23=t20*t17,t26=1/(t9*t2-t11*t5-t15*t2+t18*t5+t21*t4-t23*t1);invA[0]=(t1*t2-t4*t5)*t26,invA[1]=-(t14*t2-t17*t5)*t26,invA[2]=-(-t14*t4+t17*t1)*t26,invA[3]=-(t13*t2-t4*t20)*t26,invA[4]=(t8*t2-t23)*t26,invA[5]=-(t11-t18)*t26,invA[6]=-(-t13*t5+t1*t20)*t26,invA[7]=-(t8*t5-t21)*t26,invA[8]=(t9-t15)*t26},multiply_3x3:function(C,A,B){var Cd=C.data,Ad=A.data,Bd=B.data,m1_0=Ad[0],m1_1=Ad[1],m1_2=Ad[2],m1_3=Ad[3],m1_4=Ad[4],m1_5=Ad[5],m1_6=Ad[6],m1_7=Ad[7],m1_8=Ad[8],m2_0=Bd[0],m2_1=Bd[1],m2_2=Bd[2],m2_3=Bd[3],m2_4=Bd[4],m2_5=Bd[5],m2_6=Bd[6],m2_7=Bd[7],m2_8=Bd[8];Cd[0]=m1_0*m2_0+m1_1*m2_3+m1_2*m2_6,Cd[1]=m1_0*m2_1+m1_1*m2_4+m1_2*m2_7,Cd[2]=m1_0*m2_2+m1_1*m2_5+m1_2*m2_8,Cd[3]=m1_3*m2_0+m1_4*m2_3+m1_5*m2_6,Cd[4]=m1_3*m2_1+m1_4*m2_4+m1_5*m2_7,Cd[5]=m1_3*m2_2+m1_4*m2_5+m1_5*m2_8,Cd[6]=m1_6*m2_0+m1_7*m2_3+m1_8*m2_6,Cd[7]=m1_6*m2_1+m1_7*m2_4+m1_8*m2_7,Cd[8]=m1_6*m2_2+m1_7*m2_5+m1_8*m2_8},mat3x3_determinant:function(M){var md=M.data;return md[0]*md[4]*md[8]-md[0]*md[5]*md[7]-md[3]*md[1]*md[8]+md[3]*md[2]*md[7]+md[6]*md[1]*md[5]-md[6]*md[2]*md[4]},determinant_3x3:function(M11,M12,M13,M21,M22,M23,M31,M32,M33){return M11*M22*M33-M11*M23*M32-M21*M12*M33+M21*M13*M32+M31*M12*M23-M31*M13*M22}}}();global.matmath=matmath}(jsfeat),function(global){"use strict";var linalg=function(){var swap=function(A,i0,i1,t){t=A[i0],A[i0]=A[i1],A[i1]=t},hypot=function(a,b){return a=Math.abs(a),b=Math.abs(b),a>b?(b/=a,a*Math.sqrt(1+b*b)):b>0?(a/=b,b*Math.sqrt(1+a*a)):0},JacobiImpl=function(A,astep,W,V,vstep,n){var eps=jsfeat.EPSILON,i=0,j=0,k=0,m=0,l=0,idx=0,_in=0,_in2=0,iters=0,max_iter=n*n*30,mv=0,val=0,p=0,y=0,t=0,s=0,c=0,a0=0,b0=0,indR_buff=jsfeat.cache.get_buffer(n<<2),indC_buff=jsfeat.cache.get_buffer(n<<2),indR=indR_buff.i32,indC=indC_buff.i32;if(V)for(;n>i;i++){for(k=i*vstep,j=0;n>j;j++)V[k+j]=0;V[k+i]=1}for(k=0;n>k;k++){if(W[k]=A[(astep+1)*k],n-1>k){for(m=k+1,mv=Math.abs(A[astep*k+m]),i=k+2;n>i;i++)val=Math.abs(A[astep*k+i]),val>mv&&(mv=val,m=i);indR[k]=m}if(k>0){for(m=0,mv=Math.abs(A[k]),i=1;k>i;i++)val=Math.abs(A[astep*i+k]),val>mv&&(mv=val,m=i);indC[k]=m}}if(n>1)for(;max_iter>iters;iters++){for(k=0,mv=Math.abs(A[indR[0]]),i=1;n-1>i;i++)val=Math.abs(A[astep*i+indR[i]]),val>mv&&(mv=val,k=i);for(l=indR[k],i=1;n>i;i++)val=Math.abs(A[astep*indC[i]+i]),val>mv&&(mv=val,k=indC[i],l=i);if(p=A[astep*k+l],Math.abs(p)<=eps)break;for(y=.5*(W[l]-W[k]),t=Math.abs(y)+hypot(p,y),s=hypot(p,t),c=t/s,s=p/s,t=p/t*p,0>y&&(s=-s,t=-t),A[astep*k+l]=0,W[k]-=t,W[l]+=t,i=0;k>i;i++)_in=astep*i+k,_in2=astep*i+l,a0=A[_in],b0=A[_in2],A[_in]=a0*c-b0*s,A[_in2]=a0*s+b0*c;for(i=k+1;l>i;i++)_in=astep*k+i,_in2=astep*i+l,a0=A[_in],b0=A[_in2],A[_in]=a0*c-b0*s,A[_in2]=a0*s+b0*c;for(i=l+1,_in=astep*k+i,_in2=astep*l+i;n>i;i++,_in++,_in2++)a0=A[_in],b0=A[_in2],A[_in]=a0*c-b0*s,A[_in2]=a0*s+b0*c;if(V)for(_in=vstep*k,_in2=vstep*l,i=0;n>i;i++,_in++,_in2++)a0=V[_in],b0=V[_in2],V[_in]=a0*c-b0*s,V[_in2]=a0*s+b0*c;for(j=0;2>j;j++){if(idx=0==j?k:l,n-1>idx){for(m=idx+1,mv=Math.abs(A[astep*idx+m]),i=idx+2;n>i;i++)val=Math.abs(A[astep*idx+i]),val>mv&&(mv=val,m=i);indR[idx]=m}if(idx>0){for(m=0,mv=Math.abs(A[idx]),i=1;idx>i;i++)val=Math.abs(A[astep*i+idx]),val>mv&&(mv=val,m=i);indC[idx]=m}}}for(k=0;n-1>k;k++){for(m=k,i=k+1;n>i;i++)W[m]<W[i]&&(m=i);if(k!=m&&(swap(W,m,k,mv),V))for(i=0;n>i;i++)swap(V,vstep*m+i,vstep*k+i,mv)}jsfeat.cache.put_buffer(indR_buff),jsfeat.cache.put_buffer(indC_buff)},JacobiSVDImpl=function(At,astep,_W,Vt,vstep,m,n,n1){for(var eps=2*jsfeat.EPSILON,minval=jsfeat.FLT_MIN,i=0,j=0,k=0,iter=0,max_iter=Math.max(m,30),Ai=0,Aj=0,Vi=0,Vj=0,changed=0,c=0,s=0,t=0,t0=0,t1=0,sd=0,beta=0,gamma=0,delta=0,a=0,p=0,b=0,seed=4660,val=0,val0=0,asum=0,W_buff=jsfeat.cache.get_buffer(n<<3),W=W_buff.f64;n>i;i++){for(k=0,sd=0;m>k;k++)t=At[i*astep+k],sd+=t*t;if(W[i]=sd,Vt){for(k=0;n>k;k++)Vt[i*vstep+k]=0;Vt[i*vstep+i]=1}}for(;max_iter>iter;iter++){for(changed=0,i=0;n-1>i;i++)for(j=i+1;n>j;j++){for(Ai=i*astep|0,Aj=j*astep|0,a=W[i],p=0,b=W[j],k=2,p+=At[Ai]*At[Aj],p+=At[Ai+1]*At[Aj+1];m>k;k++)p+=At[Ai+k]*At[Aj+k];if(!(Math.abs(p)<=eps*Math.sqrt(a*b))){for(p*=2,beta=a-b,gamma=hypot(p,beta),0>beta?(delta=.5*(gamma-beta),s=Math.sqrt(delta/gamma),c=p/(gamma*s*2)):(c=Math.sqrt((gamma+beta)/(2*gamma)),s=p/(gamma*c*2)),a=0,b=0,k=2,t0=c*At[Ai]+s*At[Aj],t1=-s*At[Ai]+c*At[Aj],At[Ai]=t0,At[Aj]=t1,a+=t0*t0,b+=t1*t1,t0=c*At[Ai+1]+s*At[Aj+1],t1=-s*At[Ai+1]+c*At[Aj+1],At[Ai+1]=t0,At[Aj+1]=t1,a+=t0*t0,b+=t1*t1;m>k;k++)t0=c*At[Ai+k]+s*At[Aj+k],t1=-s*At[Ai+k]+c*At[Aj+k],At[Ai+k]=t0,At[Aj+k]=t1,a+=t0*t0,b+=t1*t1;if(W[i]=a,W[j]=b,changed=1,Vt)for(Vi=i*vstep|0,Vj=j*vstep|0,k=2,t0=c*Vt[Vi]+s*Vt[Vj],t1=-s*Vt[Vi]+c*Vt[Vj],Vt[Vi]=t0,Vt[Vj]=t1,t0=c*Vt[Vi+1]+s*Vt[Vj+1],t1=-s*Vt[Vi+1]+c*Vt[Vj+1],Vt[Vi+1]=t0,Vt[Vj+1]=t1;n>k;k++)t0=c*Vt[Vi+k]+s*Vt[Vj+k],t1=-s*Vt[Vi+k]+c*Vt[Vj+k],Vt[Vi+k]=t0,Vt[Vj+k]=t1}}if(0==changed)break}for(i=0;n>i;i++){for(k=0,sd=0;m>k;k++)t=At[i*astep+k],sd+=t*t;W[i]=Math.sqrt(sd)}for(i=0;n-1>i;i++){for(j=i,k=i+1;n>k;k++)W[j]<W[k]&&(j=k);if(i!=j&&(swap(W,i,j,sd),Vt)){for(k=0;m>k;k++)swap(At,i*astep+k,j*astep+k,t);for(k=0;n>k;k++)swap(Vt,i*vstep+k,j*vstep+k,t)}}for(i=0;n>i;i++)_W[i]=W[i];if(!Vt)return void jsfeat.cache.put_buffer(W_buff);for(i=0;n1>i;i++){for(sd=n>i?W[i]:0;minval>=sd;){for(val0=1/m,k=0;m>k;k++)seed=214013*seed+2531011,val=0!=(seed>>16&32767&256)?val0:-val0,At[i*astep+k]=val;for(iter=0;2>iter;iter++)for(j=0;i>j;j++){for(sd=0,k=0;m>k;k++)sd+=At[i*astep+k]*At[j*astep+k];for(asum=0,k=0;m>k;k++)t=At[i*astep+k]-sd*At[j*astep+k],At[i*astep+k]=t,asum+=Math.abs(t);for(asum=asum?1/asum:0,k=0;m>k;k++)At[i*astep+k]*=asum}for(sd=0,k=0;m>k;k++)t=At[i*astep+k],sd+=t*t;sd=Math.sqrt(sd)}for(s=1/sd,k=0;m>k;k++)At[i*astep+k]*=s}jsfeat.cache.put_buffer(W_buff)};return{lu_solve:function(A,B){var t,alpha,d,s,i=0,j=0,k=0,p=1,astep=A.cols,ad=A.data,bd=B.data;for(i=0;astep>i;i++){for(k=i,j=i+1;astep>j;j++)Math.abs(ad[j*astep+i])>Math.abs(ad[k*astep+i])&&(k=j);if(Math.abs(ad[k*astep+i])<jsfeat.EPSILON)return 0;if(k!=i){for(j=i;astep>j;j++)swap(ad,i*astep+j,k*astep+j,t);swap(bd,i,k,t),p=-p}for(d=-1/ad[i*astep+i],j=i+1;astep>j;j++){for(alpha=ad[j*astep+i]*d,k=i+1;astep>k;k++)ad[j*astep+k]+=alpha*ad[i*astep+k];bd[j]+=alpha*bd[i]}ad[i*astep+i]=-d}for(i=astep-1;i>=0;i--){for(s=bd[i],k=i+1;astep>k;k++)s-=ad[i*astep+k]*bd[k];bd[i]=s*ad[i*astep+i]}return 1},cholesky_solve:function(A,B){var val,inv_diag,col=0,row=0,col2=0,cs=0,rs=0,i=0,j=0,size=A.cols,ad=A.data,bd=B.data;for(col=0;size>col;col++)for(inv_diag=1,cs=col*size,rs=cs,row=col;size>row;row++){for(val=ad[rs+col],col2=0;col>col2;col2++)val-=ad[col2*size+col]*ad[rs+col2];if(row==col){if(ad[rs+col]=val,0==val)return 0;inv_diag=1/val}else ad[cs+row]=val,ad[rs+col]=val*inv_diag;rs+=size}for(cs=0,i=0;size>i;i++){for(val=bd[i],j=0;i>j;j++)val-=ad[cs+j]*bd[j];bd[i]=val,cs+=size}for(cs=0,i=0;size>i;i++)bd[i]/=ad[cs+i],cs+=size;for(i=size-1;i>=0;i--){for(val=bd[i],j=i+1,cs=j*size;size>j;j++)val-=ad[cs+i]*bd[j],cs+=size;bd[i]=val}return 1},svd_decompose:function(A,W,U,V,options){"undefined"==typeof options&&(options=0);var at=0,i=0,_m=A.rows,_n=A.cols,m=_m,n=_n,dt=A.type|jsfeat.C1_t;n>m&&(at=1,i=m,m=n,n=i);var a_buff=jsfeat.cache.get_buffer(m*m<<3),w_buff=jsfeat.cache.get_buffer(n<<3),v_buff=jsfeat.cache.get_buffer(n*n<<3),a_mt=new jsfeat.matrix_t(m,m,dt,a_buff.data),w_mt=new jsfeat.matrix_t(1,n,dt,w_buff.data),v_mt=new jsfeat.matrix_t(n,n,dt,v_buff.data);if(0==at)jsfeat.matmath.transpose(a_mt,A);else{for(i=0;_n*_m>i;i++)a_mt.data[i]=A.data[i];for(;n*m>i;i++)a_mt.data[i]=0}if(JacobiSVDImpl(a_mt.data,m,w_mt.data,v_mt.data,n,m,n,m),W){for(i=0;n>i;i++)W.data[i]=w_mt.data[i];for(;_n>i;i++)W.data[i]=0}if(0==at){if(U&&options&jsfeat.SVD_U_T)for(i=m*m;--i>=0;)U.data[i]=a_mt.data[i];else U&&jsfeat.matmath.transpose(U,a_mt);if(V&&options&jsfeat.SVD_V_T)for(i=n*n;--i>=0;)V.data[i]=v_mt.data[i];else V&&jsfeat.matmath.transpose(V,v_mt)}else{if(U&&options&jsfeat.SVD_U_T)for(i=n*n;--i>=0;)U.data[i]=v_mt.data[i];else U&&jsfeat.matmath.transpose(U,v_mt);if(V&&options&jsfeat.SVD_V_T)for(i=m*m;--i>=0;)V.data[i]=a_mt.data[i];else V&&jsfeat.matmath.transpose(V,a_mt)}jsfeat.cache.put_buffer(a_buff),jsfeat.cache.put_buffer(w_buff),jsfeat.cache.put_buffer(v_buff)},svd_solve:function(A,X,B){var i=0,j=0,k=0,pu=0,pv=0,nrows=A.rows,ncols=A.cols,sum=0,xsum=0,tol=0,dt=A.type|jsfeat.C1_t,u_buff=jsfeat.cache.get_buffer(nrows*nrows<<3),w_buff=jsfeat.cache.get_buffer(ncols<<3),v_buff=jsfeat.cache.get_buffer(ncols*ncols<<3),u_mt=new jsfeat.matrix_t(nrows,nrows,dt,u_buff.data),w_mt=new jsfeat.matrix_t(1,ncols,dt,w_buff.data),v_mt=new jsfeat.matrix_t(ncols,ncols,dt,v_buff.data),bd=B.data,ud=u_mt.data,wd=w_mt.data,vd=v_mt.data;for(this.svd_decompose(A,w_mt,u_mt,v_mt,0),tol=jsfeat.EPSILON*wd[0]*ncols;ncols>i;i++,pv+=ncols){for(xsum=0,j=0;ncols>j;j++)if(wd[j]>tol){for(k=0,sum=0,pu=0;nrows>k;k++,pu+=ncols)sum+=ud[pu+j]*bd[k];xsum+=sum*vd[pv+j]/wd[j]}X.data[i]=xsum}jsfeat.cache.put_buffer(u_buff),jsfeat.cache.put_buffer(w_buff),jsfeat.cache.put_buffer(v_buff)},svd_invert:function(Ai,A){var i=0,j=0,k=0,pu=0,pv=0,pa=0,nrows=A.rows,ncols=A.cols,sum=0,tol=0,dt=A.type|jsfeat.C1_t,u_buff=jsfeat.cache.get_buffer(nrows*nrows<<3),w_buff=jsfeat.cache.get_buffer(ncols<<3),v_buff=jsfeat.cache.get_buffer(ncols*ncols<<3),u_mt=new jsfeat.matrix_t(nrows,nrows,dt,u_buff.data),w_mt=new jsfeat.matrix_t(1,ncols,dt,w_buff.data),v_mt=new jsfeat.matrix_t(ncols,ncols,dt,v_buff.data),id=Ai.data,ud=u_mt.data,wd=w_mt.data,vd=v_mt.data;for(this.svd_decompose(A,w_mt,u_mt,v_mt,0),tol=jsfeat.EPSILON*wd[0]*ncols;ncols>i;i++,pv+=ncols)for(j=0,pu=0;nrows>j;j++,pa++){for(k=0,sum=0;ncols>k;k++,pu++)wd[k]>tol&&(sum+=vd[pv+k]*ud[pu]/wd[k]);id[pa]=sum}jsfeat.cache.put_buffer(u_buff),jsfeat.cache.put_buffer(w_buff),jsfeat.cache.put_buffer(v_buff)},eigenVV:function(A,vects,vals){for(var n=A.cols,i=n*n,dt=A.type|jsfeat.C1_t,a_buff=jsfeat.cache.get_buffer(n*n<<3),w_buff=jsfeat.cache.get_buffer(n<<3),a_mt=new jsfeat.matrix_t(n,n,dt,a_buff.data),w_mt=new jsfeat.matrix_t(1,n,dt,w_buff.data);--i>=0;)a_mt.data[i]=A.data[i];if(JacobiImpl(a_mt.data,n,w_mt.data,vects?vects.data:null,n,n),vals)for(;--n>=0;)vals.data[n]=w_mt.data[n];jsfeat.cache.put_buffer(a_buff),jsfeat.cache.put_buffer(w_buff)}}}();global.linalg=linalg}(jsfeat),function(global){"use strict";var motion_model=function(){var sqr=function(x){return x*x},iso_normalize_points=function(from,to,T0,T1,count){for(var i=0,cx0=0,cy0=0,d0=0,s0=0,cx1=0,cy1=0,d1=0,s1=0,dx=0,dy=0;count>i;++i)cx0+=from[i].x,cy0+=from[i].y,cx1+=to[i].x,cy1+=to[i].y;for(cx0/=count,cy0/=count,cx1/=count,cy1/=count,i=0;count>i;++i)dx=from[i].x-cx0,dy=from[i].y-cy0,d0+=Math.sqrt(dx*dx+dy*dy),dx=to[i].x-cx1,dy=to[i].y-cy1,d1+=Math.sqrt(dx*dx+dy*dy);d0/=count,d1/=count,s0=Math.SQRT2/d0,s1=Math.SQRT2/d1,T0[0]=T0[4]=s0,T0[2]=-cx0*s0,T0[5]=-cy0*s0,T0[1]=T0[3]=T0[6]=T0[7]=0,T0[8]=1,T1[0]=T1[4]=s1,T1[2]=-cx1*s1,T1[5]=-cy1*s1,T1[1]=T1[3]=T1[6]=T1[7]=0,T1[8]=1},T0=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),T1=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),AtA=new jsfeat.matrix_t(6,6,jsfeat.F32_t|jsfeat.C1_t),AtB=new jsfeat.matrix_t(6,1,jsfeat.F32_t|jsfeat.C1_t),affine2d=function(){function affine2d(){}return affine2d.prototype.run=function(from,to,model,count){var pt0,pt1,i=0,j=0,dt=model.type|jsfeat.C1_t,md=model.data,t0d=T0.data,t1d=T1.data,px=0,py=0;iso_normalize_points(from,to,t0d,t1d,count);for(var a_buff=jsfeat.cache.get_buffer(2*count*6<<3),b_buff=jsfeat.cache.get_buffer(2*count<<3),a_mt=new jsfeat.matrix_t(6,2*count,dt,a_buff.data),b_mt=new jsfeat.matrix_t(1,2*count,dt,b_buff.data),ad=a_mt.data,bd=b_mt.data;count>i;++i)pt0=from[i],pt1=to[i],px=t0d[0]*pt0.x+t0d[1]*pt0.y+t0d[2],py=t0d[3]*pt0.x+t0d[4]*pt0.y+t0d[5],j=2*i*6,ad[j]=px,ad[j+1]=py,ad[j+2]=1,ad[j+3]=0,ad[j+4]=0,ad[j+5]=0,j+=6,ad[j]=0,ad[j+1]=0,ad[j+2]=0,ad[j+3]=px,ad[j+4]=py,ad[j+5]=1,bd[i<<1]=t1d[0]*pt1.x+t1d[1]*pt1.y+t1d[2],bd[(i<<1)+1]=t1d[3]*pt1.x+t1d[4]*pt1.y+t1d[5];return jsfeat.matmath.multiply_AtA(AtA,a_mt),jsfeat.matmath.multiply_AtB(AtB,a_mt,b_mt),jsfeat.linalg.lu_solve(AtA,AtB),md[0]=AtB.data[0],md[1]=AtB.data[1],md[2]=AtB.data[2],md[3]=AtB.data[3],md[4]=AtB.data[4],md[5]=AtB.data[5],md[6]=0,md[7]=0,md[8]=1,jsfeat.matmath.invert_3x3(T1,T1),jsfeat.matmath.multiply_3x3(model,T1,model),jsfeat.matmath.multiply_3x3(model,model,T0),jsfeat.cache.put_buffer(a_buff),jsfeat.cache.put_buffer(b_buff),1},affine2d.prototype.error=function(from,to,model,err,count){for(var pt0,pt1,i=0,m=model.data;count>i;++i)pt0=from[i],pt1=to[i],err[i]=sqr(pt1.x-m[0]*pt0.x-m[1]*pt0.y-m[2])+sqr(pt1.y-m[3]*pt0.x-m[4]*pt0.y-m[5])},affine2d.prototype.check_subset=function(from,to,count){return!0},affine2d}(),mLtL=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),Evec=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),homography2d=function(){function homography2d(){}return homography2d.prototype.run=function(from,to,model,count){for(var i=0,j=0,md=model.data,t0d=T0.data,t1d=T1.data,LtL=mLtL.data,evd=Evec.data,x=0,y=0,X=0,Y=0,smx=0,smy=0,cmx=0,cmy=0,sMx=0,sMy=0,cMx=0,cMy=0;count>i;++i)cmx+=to[i].x,cmy+=to[i].y,cMx+=from[i].x,cMy+=from[i].y;for(cmx/=count,cmy/=count,cMx/=count,cMy/=count,i=0;count>i;++i)smx+=Math.abs(to[i].x-cmx),smy+=Math.abs(to[i].y-cmy),sMx+=Math.abs(from[i].x-cMx),sMy+=Math.abs(from[i].y-cMy);if(Math.abs(smx)<jsfeat.EPSILON||Math.abs(smy)<jsfeat.EPSILON||Math.abs(sMx)<jsfeat.EPSILON||Math.abs(sMy)<jsfeat.EPSILON)return 0;for(smx=count/smx,smy=count/smy,sMx=count/sMx,sMy=count/sMy,t0d[0]=sMx,t0d[1]=0,t0d[2]=-cMx*sMx,t0d[3]=0,t0d[4]=sMy,t0d[5]=-cMy*sMy,t0d[6]=0,t0d[7]=0,t0d[8]=1,t1d[0]=1/smx,t1d[1]=0,t1d[2]=cmx,t1d[3]=0,t1d[4]=1/smy,t1d[5]=cmy,t1d[6]=0,t1d[7]=0,t1d[8]=1,i=81;--i>=0;)LtL[i]=0;for(i=0;count>i;++i)x=(to[i].x-cmx)*smx,y=(to[i].y-cmy)*smy,X=(from[i].x-cMx)*sMx,Y=(from[i].y-cMy)*sMy,LtL[0]+=X*X,LtL[1]+=X*Y,LtL[2]+=X,LtL[6]+=X*-x*X,LtL[7]+=X*-x*Y,LtL[8]+=X*-x,LtL[10]+=Y*Y,LtL[11]+=Y,LtL[15]+=Y*-x*X,LtL[16]+=Y*-x*Y,LtL[17]+=Y*-x,LtL[20]+=1,LtL[24]+=-x*X,LtL[25]+=-x*Y,LtL[26]+=-x,LtL[30]+=X*X,LtL[31]+=X*Y,LtL[32]+=X,LtL[33]+=X*-y*X,LtL[34]+=X*-y*Y,LtL[35]+=X*-y,LtL[40]+=Y*Y,LtL[41]+=Y,LtL[42]+=Y*-y*X,LtL[43]+=Y*-y*Y,LtL[44]+=Y*-y,LtL[50]+=1,LtL[51]+=-y*X,LtL[52]+=-y*Y,LtL[53]+=-y,LtL[60]+=-x*X*-x*X+-y*X*-y*X,LtL[61]+=-x*X*-x*Y+-y*X*-y*Y,LtL[62]+=-x*X*-x+-y*X*-y,LtL[70]+=-x*Y*-x*Y+-y*Y*-y*Y,LtL[71]+=-x*Y*-x+-y*Y*-y,LtL[80]+=-x*-x+-y*-y;for(i=0;9>i;++i)for(j=0;i>j;++j)LtL[9*i+j]=LtL[9*j+i];return jsfeat.linalg.eigenVV(mLtL,Evec),md[0]=evd[72],md[1]=evd[73],md[2]=evd[74],md[3]=evd[75],md[4]=evd[76],md[5]=evd[77],md[6]=evd[78],md[7]=evd[79],md[8]=evd[80],jsfeat.matmath.multiply_3x3(model,T1,model),jsfeat.matmath.multiply_3x3(model,model,T0),x=1/md[8],md[0]*=x,md[1]*=x,md[2]*=x,md[3]*=x,md[4]*=x,md[5]*=x,md[6]*=x,md[7]*=x,md[8]=1,1},homography2d.prototype.error=function(from,to,model,err,count){for(var pt0,pt1,i=0,ww=0,dx=0,dy=0,m=model.data;count>i;++i)pt0=from[i],pt1=to[i],ww=1/(m[6]*pt0.x+m[7]*pt0.y+1),dx=(m[0]*pt0.x+m[1]*pt0.y+m[2])*ww-pt1.x,dy=(m[3]*pt0.x+m[4]*pt0.y+m[5])*ww-pt1.y,err[i]=dx*dx+dy*dy},homography2d.prototype.check_subset=function(from,to,count){if(4==count){var negative=0,fp0=from[0],fp1=from[1],fp2=from[2],fp3=from[3],tp0=to[0],tp1=to[1],tp2=to[2],tp3=to[3],A11=fp0.x,A12=fp0.y,A13=1,A21=fp1.x,A22=fp1.y,A23=1,A31=fp2.x,A32=fp2.y,A33=1,B11=tp0.x,B12=tp0.y,B13=1,B21=tp1.x,B22=tp1.y,B23=1,B31=tp2.x,B32=tp2.y,B33=1,detA=jsfeat.matmath.determinant_3x3(A11,A12,A13,A21,A22,A23,A31,A32,A33),detB=jsfeat.matmath.determinant_3x3(B11,B12,B13,B21,B22,B23,B31,B32,B33);if(0>detA*detB&&negative++,A11=fp1.x,A12=fp1.y,A21=fp2.x,A22=fp2.y,A31=fp3.x,A32=fp3.y,B11=tp1.x,B12=tp1.y,B21=tp2.x,B22=tp2.y,B31=tp3.x,B32=tp3.y,detA=jsfeat.matmath.determinant_3x3(A11,A12,A13,A21,A22,A23,A31,A32,A33),detB=jsfeat.matmath.determinant_3x3(B11,B12,B13,B21,B22,B23,B31,B32,B33),0>detA*detB&&negative++,A11=fp0.x,A12=fp0.y,A21=fp2.x,A22=fp2.y,A31=fp3.x,A32=fp3.y,B11=tp0.x,B12=tp0.y,B21=tp2.x,B22=tp2.y,B31=tp3.x,B32=tp3.y,detA=jsfeat.matmath.determinant_3x3(A11,A12,A13,A21,A22,A23,A31,A32,A33),detB=jsfeat.matmath.determinant_3x3(B11,B12,B13,B21,B22,B23,B31,B32,B33),0>detA*detB&&negative++,A11=fp0.x,A12=fp0.y,A21=fp1.x,A22=fp1.y,A31=fp3.x,A32=fp3.y,B11=tp0.x,B12=tp0.y,B21=tp1.x,B22=tp1.y,B31=tp3.x,B32=tp3.y,detA=jsfeat.matmath.determinant_3x3(A11,A12,A13,A21,A22,A23,A31,A32,A33),detB=jsfeat.matmath.determinant_3x3(B11,B12,B13,B21,B22,B23,B31,B32,B33),0>detA*detB&&negative++,0!=negative&&4!=negative)return!1}return!0},homography2d}();return{affine2d:affine2d,homography2d:homography2d}}(),ransac_params_t=function(){function ransac_params_t(size,thresh,eps,prob){"undefined"==typeof size&&(size=0),"undefined"==typeof thresh&&(thresh=.5),"undefined"==typeof eps&&(eps=.5),"undefined"==typeof prob&&(prob=.99),this.size=size,this.thresh=thresh,this.eps=eps,this.prob=prob}return ransac_params_t.prototype.update_iters=function(_eps,max_iters){var num=Math.log(1-this.prob),denom=Math.log(1-Math.pow(1-_eps,this.size));return 0|(denom>=0||-num>=max_iters*-denom?max_iters:Math.round(num/denom))},ransac_params_t}(),motion_estimator=function(){var get_subset=function(kernel,from,to,need_cnt,max_cnt,from_sub,to_sub){for(var max_try=1e3,indices=[],i=0,j=0,ssiter=0,idx_i=0,ok=!1;max_try>ssiter;++ssiter){for(i=0;need_cnt>i&&max_try>ssiter;){for(ok=!1,idx_i=0;!ok;)for(ok=!0,idx_i=indices[i]=0|Math.floor(Math.random()*max_cnt),j=0;i>j;++j)if(idx_i==indices[j]){ok=!1;break}from_sub[i]=from[idx_i],to_sub[i]=to[idx_i],kernel.check_subset(from_sub,to_sub,i+1)?++i:ssiter++}break}return i==need_cnt&&max_try>ssiter},find_inliers=function(kernel,model,from,to,count,thresh,err,mask){var numinliers=0,i=0,f=0,t=thresh*thresh;for(kernel.error(from,to,model,err,count);count>i;++i)f=err[i]<=t,mask[i]=f,numinliers+=f;return numinliers};return{ransac:function(params,kernel,from,to,count,model,mask,max_iters){if("undefined"==typeof max_iters&&(max_iters=1e3),count<params.size)return!1;var model_points=params.size,niters=max_iters,iter=0,result=!1,subset0=[],subset1=[],found=!1,mc=model.cols,mr=model.rows,dt=model.type|jsfeat.C1_t,m_buff=jsfeat.cache.get_buffer(mc*mr<<3),ms_buff=jsfeat.cache.get_buffer(count),err_buff=jsfeat.cache.get_buffer(count<<2),M=new jsfeat.matrix_t(mc,mr,dt,m_buff.data),curr_mask=new jsfeat.matrix_t(count,1,jsfeat.U8C1_t,ms_buff.data),inliers_max=-1,numinliers=0,nmodels=0,err=err_buff.f32;
if(count==model_points){if(kernel.run(from,to,M,count)<=0)return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!1;if(M.copy_to(model),mask)for(;--count>=0;)mask.data[count]=1;return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!0}for(;niters>iter;++iter){if(found=get_subset(kernel,from,to,model_points,count,subset0,subset1),!found){if(0==iter)return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!1;break}nmodels=kernel.run(subset0,subset1,M,model_points),0>=nmodels||(numinliers=find_inliers(kernel,M,from,to,count,params.thresh,err,curr_mask.data),numinliers>Math.max(inliers_max,model_points-1)&&(M.copy_to(model),inliers_max=numinliers,mask&&curr_mask.copy_to(mask),niters=params.update_iters((count-numinliers)/count,niters),result=!0))}return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),result},lmeds:function(params,kernel,from,to,count,model,mask,max_iters){if("undefined"==typeof max_iters&&(max_iters=1e3),count<params.size)return!1;var model_points=params.size,niters=max_iters,iter=0,result=!1,subset0=[],subset1=[],found=!1,mc=model.cols,mr=model.rows,dt=model.type|jsfeat.C1_t,m_buff=jsfeat.cache.get_buffer(mc*mr<<3),ms_buff=jsfeat.cache.get_buffer(count),err_buff=jsfeat.cache.get_buffer(count<<2),M=new jsfeat.matrix_t(mc,mr,dt,m_buff.data),curr_mask=new jsfeat.matrix_t(count,1,jsfeat.U8_t|jsfeat.C1_t,ms_buff.data),numinliers=0,nmodels=0,err=err_buff.f32,min_median=1e9,sigma=0,median=0;if(params.eps=.45,niters=params.update_iters(params.eps,niters),count==model_points){if(kernel.run(from,to,M,count)<=0)return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!1;if(M.copy_to(model),mask)for(;--count>=0;)mask.data[count]=1;return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!0}for(;niters>iter;++iter){if(found=get_subset(kernel,from,to,model_points,count,subset0,subset1),!found){if(0==iter)return jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),!1;break}nmodels=kernel.run(subset0,subset1,M,model_points),0>=nmodels||(kernel.error(from,to,M,err,count),median=jsfeat.math.median(err,0,count-1),min_median>median&&(min_median=median,M.copy_to(model),result=!0))}return result&&(sigma=2.5*1.4826*(1+5/(count-model_points))*Math.sqrt(min_median),sigma=Math.max(sigma,.001),numinliers=find_inliers(kernel,model,from,to,count,sigma,err,curr_mask.data),mask&&curr_mask.copy_to(mask),result=numinliers>=model_points),jsfeat.cache.put_buffer(m_buff),jsfeat.cache.put_buffer(ms_buff),jsfeat.cache.put_buffer(err_buff),result}}}();global.ransac_params_t=ransac_params_t,global.motion_model=motion_model,global.motion_estimator=motion_estimator}(jsfeat),function(global){"use strict";var imgproc=function(){var _resample_u8=function(src,dst,nw,nh){for(var xofs_count=0,ch=src.channel,w=src.cols,h=src.rows,src_d=src.data,dst_d=dst.data,scale_x=w/nw,scale_y=h/nh,inv_scale_256=scale_x*scale_y*65536|0,dx=0,dy=0,sx=0,sy=0,sx1=0,sx2=0,i=0,k=0,fsx1=0,fsx2=0,a=0,b=0,dxn=0,alpha=0,beta=0,beta1=0,buf_node=jsfeat.cache.get_buffer(nw*ch<<2),sum_node=jsfeat.cache.get_buffer(nw*ch<<2),xofs_node=jsfeat.cache.get_buffer(2*w*3<<2),buf=buf_node.i32,sum=sum_node.i32,xofs=xofs_node.i32;nw>dx;dx++){for(fsx1=dx*scale_x,fsx2=fsx1+scale_x,sx1=fsx1+1-1e-6|0,sx2=0|fsx2,sx1=Math.min(sx1,w-1),sx2=Math.min(sx2,w-1),sx1>fsx1&&(xofs[k++]=dx*ch|0,xofs[k++]=(sx1-1)*ch|0,xofs[k++]=256*(sx1-fsx1)|0,xofs_count++),sx=sx1;sx2>sx;sx++)xofs_count++,xofs[k++]=dx*ch|0,xofs[k++]=sx*ch|0,xofs[k++]=256;fsx2-sx2>.001&&(xofs_count++,xofs[k++]=dx*ch|0,xofs[k++]=sx2*ch|0,xofs[k++]=256*(fsx2-sx2)|0)}for(dx=0;nw*ch>dx;dx++)buf[dx]=sum[dx]=0;for(dy=0,sy=0;h>sy;sy++){for(a=w*sy,k=0;xofs_count>k;k++)for(dxn=xofs[3*k],sx1=xofs[3*k+1],alpha=xofs[3*k+2],i=0;ch>i;i++)buf[dxn+i]+=src_d[a+sx1+i]*alpha;if(sy+1>=(dy+1)*scale_y||sy==h-1){if(beta=256*Math.max(sy+1-(dy+1)*scale_y,0)|0,beta1=256-beta,b=nw*dy,0>=beta)for(dx=0;nw*ch>dx;dx++)dst_d[b+dx]=Math.min(Math.max((sum[dx]+256*buf[dx])/inv_scale_256,0),255),sum[dx]=buf[dx]=0;else for(dx=0;nw*ch>dx;dx++)dst_d[b+dx]=Math.min(Math.max((sum[dx]+buf[dx]*beta1)/inv_scale_256,0),255),sum[dx]=buf[dx]*beta,buf[dx]=0;dy++}else for(dx=0;nw*ch>dx;dx++)sum[dx]+=256*buf[dx],buf[dx]=0}jsfeat.cache.put_buffer(sum_node),jsfeat.cache.put_buffer(buf_node),jsfeat.cache.put_buffer(xofs_node)},_resample=function(src,dst,nw,nh){for(var xofs_count=0,ch=src.channel,w=src.cols,h=src.rows,src_d=src.data,dst_d=dst.data,scale_x=w/nw,scale_y=h/nh,scale=1/(scale_x*scale_y),dx=0,dy=0,sx=0,sy=0,sx1=0,sx2=0,i=0,k=0,fsx1=0,fsx2=0,a=0,b=0,dxn=0,alpha=0,beta=0,beta1=0,buf_node=jsfeat.cache.get_buffer(nw*ch<<2),sum_node=jsfeat.cache.get_buffer(nw*ch<<2),xofs_node=jsfeat.cache.get_buffer(2*w*3<<2),buf=buf_node.f32,sum=sum_node.f32,xofs=xofs_node.f32;nw>dx;dx++){for(fsx1=dx*scale_x,fsx2=fsx1+scale_x,sx1=fsx1+1-1e-6|0,sx2=0|fsx2,sx1=Math.min(sx1,w-1),sx2=Math.min(sx2,w-1),sx1>fsx1&&(xofs_count++,xofs[k++]=(sx1-1)*ch|0,xofs[k++]=dx*ch|0,xofs[k++]=(sx1-fsx1)*scale),sx=sx1;sx2>sx;sx++)xofs_count++,xofs[k++]=sx*ch|0,xofs[k++]=dx*ch|0,xofs[k++]=scale;fsx2-sx2>.001&&(xofs_count++,xofs[k++]=sx2*ch|0,xofs[k++]=dx*ch|0,xofs[k++]=(fsx2-sx2)*scale)}for(dx=0;nw*ch>dx;dx++)buf[dx]=sum[dx]=0;for(dy=0,sy=0;h>sy;sy++){for(a=w*sy,k=0;xofs_count>k;k++)for(sx1=0|xofs[3*k],dxn=0|xofs[3*k+1],alpha=xofs[3*k+2],i=0;ch>i;i++)buf[dxn+i]+=src_d[a+sx1+i]*alpha;if(sy+1>=(dy+1)*scale_y||sy==h-1){if(beta=Math.max(sy+1-(dy+1)*scale_y,0),beta1=1-beta,b=nw*dy,Math.abs(beta)<.001)for(dx=0;nw*ch>dx;dx++)dst_d[b+dx]=sum[dx]+buf[dx],sum[dx]=buf[dx]=0;else for(dx=0;nw*ch>dx;dx++)dst_d[b+dx]=sum[dx]+buf[dx]*beta1,sum[dx]=buf[dx]*beta,buf[dx]=0;dy++}else for(dx=0;nw*ch>dx;dx++)sum[dx]+=buf[dx],buf[dx]=0}jsfeat.cache.put_buffer(sum_node),jsfeat.cache.put_buffer(buf_node),jsfeat.cache.put_buffer(xofs_node)},_convol_u8=function(buf,src_d,dst_d,w,h,filter,kernel_size,half_kernel){for(var i=0,j=0,k=0,sp=0,dp=0,sum=0,sum1=0,sum2=0,sum3=0,f0=filter[0],fk=0,w2=w<<1,w3=3*w,w4=w<<2;h>i;++i){for(sum=src_d[sp],j=0;half_kernel>j;++j)buf[j]=sum;for(j=0;w-2>=j;j+=2)buf[j+half_kernel]=src_d[sp+j],buf[j+half_kernel+1]=src_d[sp+j+1];for(;w>j;++j)buf[j+half_kernel]=src_d[sp+j];for(sum=src_d[sp+w-1],j=w;half_kernel+w>j;++j)buf[j+half_kernel]=sum;for(j=0;w-4>=j;j+=4){for(sum=buf[j]*f0,sum1=buf[j+1]*f0,sum2=buf[j+2]*f0,sum3=buf[j+3]*f0,k=1;kernel_size>k;++k)fk=filter[k],sum+=buf[k+j]*fk,sum1+=buf[k+j+1]*fk,sum2+=buf[k+j+2]*fk,sum3+=buf[k+j+3]*fk;dst_d[dp+j]=Math.min(sum>>8,255),dst_d[dp+j+1]=Math.min(sum1>>8,255),dst_d[dp+j+2]=Math.min(sum2>>8,255),dst_d[dp+j+3]=Math.min(sum3>>8,255)}for(;w>j;++j){for(sum=buf[j]*f0,k=1;kernel_size>k;++k)sum+=buf[k+j]*filter[k];dst_d[dp+j]=Math.min(sum>>8,255)}sp+=w,dp+=w}for(i=0;w>i;++i){for(sum=dst_d[i],j=0;half_kernel>j;++j)buf[j]=sum;for(k=i,j=0;h-2>=j;j+=2,k+=w2)buf[j+half_kernel]=dst_d[k],buf[j+half_kernel+1]=dst_d[k+w];for(;h>j;++j,k+=w)buf[j+half_kernel]=dst_d[k];for(sum=dst_d[(h-1)*w+i],j=h;half_kernel+h>j;++j)buf[j+half_kernel]=sum;for(dp=i,j=0;h-4>=j;j+=4,dp+=w4){for(sum=buf[j]*f0,sum1=buf[j+1]*f0,sum2=buf[j+2]*f0,sum3=buf[j+3]*f0,k=1;kernel_size>k;++k)fk=filter[k],sum+=buf[k+j]*fk,sum1+=buf[k+j+1]*fk,sum2+=buf[k+j+2]*fk,sum3+=buf[k+j+3]*fk;dst_d[dp]=Math.min(sum>>8,255),dst_d[dp+w]=Math.min(sum1>>8,255),dst_d[dp+w2]=Math.min(sum2>>8,255),dst_d[dp+w3]=Math.min(sum3>>8,255)}for(;h>j;++j,dp+=w){for(sum=buf[j]*f0,k=1;kernel_size>k;++k)sum+=buf[k+j]*filter[k];dst_d[dp]=Math.min(sum>>8,255)}}},_convol=function(buf,src_d,dst_d,w,h,filter,kernel_size,half_kernel){for(var i=0,j=0,k=0,sp=0,dp=0,sum=0,sum1=0,sum2=0,sum3=0,f0=filter[0],fk=0,w2=w<<1,w3=3*w,w4=w<<2;h>i;++i){for(sum=src_d[sp],j=0;half_kernel>j;++j)buf[j]=sum;for(j=0;w-2>=j;j+=2)buf[j+half_kernel]=src_d[sp+j],buf[j+half_kernel+1]=src_d[sp+j+1];for(;w>j;++j)buf[j+half_kernel]=src_d[sp+j];for(sum=src_d[sp+w-1],j=w;half_kernel+w>j;++j)buf[j+half_kernel]=sum;for(j=0;w-4>=j;j+=4){for(sum=buf[j]*f0,sum1=buf[j+1]*f0,sum2=buf[j+2]*f0,sum3=buf[j+3]*f0,k=1;kernel_size>k;++k)fk=filter[k],sum+=buf[k+j]*fk,sum1+=buf[k+j+1]*fk,sum2+=buf[k+j+2]*fk,sum3+=buf[k+j+3]*fk;dst_d[dp+j]=sum,dst_d[dp+j+1]=sum1,dst_d[dp+j+2]=sum2,dst_d[dp+j+3]=sum3}for(;w>j;++j){for(sum=buf[j]*f0,k=1;kernel_size>k;++k)sum+=buf[k+j]*filter[k];dst_d[dp+j]=sum}sp+=w,dp+=w}for(i=0;w>i;++i){for(sum=dst_d[i],j=0;half_kernel>j;++j)buf[j]=sum;for(k=i,j=0;h-2>=j;j+=2,k+=w2)buf[j+half_kernel]=dst_d[k],buf[j+half_kernel+1]=dst_d[k+w];for(;h>j;++j,k+=w)buf[j+half_kernel]=dst_d[k];for(sum=dst_d[(h-1)*w+i],j=h;half_kernel+h>j;++j)buf[j+half_kernel]=sum;for(dp=i,j=0;h-4>=j;j+=4,dp+=w4){for(sum=buf[j]*f0,sum1=buf[j+1]*f0,sum2=buf[j+2]*f0,sum3=buf[j+3]*f0,k=1;kernel_size>k;++k)fk=filter[k],sum+=buf[k+j]*fk,sum1+=buf[k+j+1]*fk,sum2+=buf[k+j+2]*fk,sum3+=buf[k+j+3]*fk;dst_d[dp]=sum,dst_d[dp+w]=sum1,dst_d[dp+w2]=sum2,dst_d[dp+w3]=sum3}for(;h>j;++j,dp+=w){for(sum=buf[j]*f0,k=1;kernel_size>k;++k)sum+=buf[k+j]*filter[k];dst_d[dp]=sum}}};return{grayscale:function(src,w,h,dst,code){"undefined"==typeof code&&(code=jsfeat.COLOR_RGBA2GRAY);var x=0,y=0,i=0,j=0,ir=0,jr=0,coeff_r=4899,coeff_g=9617,coeff_b=1868,cn=4;(code==jsfeat.COLOR_BGRA2GRAY||code==jsfeat.COLOR_BGR2GRAY)&&(coeff_r=1868,coeff_b=4899),(code==jsfeat.COLOR_RGB2GRAY||code==jsfeat.COLOR_BGR2GRAY)&&(cn=3);var cn2=cn<<1,cn3=3*cn|0;dst.resize(w,h,1);var dst_u8=dst.data;for(y=0;h>y;++y,j+=w,i+=w*cn){for(x=0,ir=i,jr=j;w-4>=x;x+=4,ir+=cn<<2,jr+=4)dst_u8[jr]=src[ir]*coeff_r+src[ir+1]*coeff_g+src[ir+2]*coeff_b+8192>>14,dst_u8[jr+1]=src[ir+cn]*coeff_r+src[ir+cn+1]*coeff_g+src[ir+cn+2]*coeff_b+8192>>14,dst_u8[jr+2]=src[ir+cn2]*coeff_r+src[ir+cn2+1]*coeff_g+src[ir+cn2+2]*coeff_b+8192>>14,dst_u8[jr+3]=src[ir+cn3]*coeff_r+src[ir+cn3+1]*coeff_g+src[ir+cn3+2]*coeff_b+8192>>14;for(;w>x;++x,++jr,ir+=cn)dst_u8[jr]=src[ir]*coeff_r+src[ir+1]*coeff_g+src[ir+2]*coeff_b+8192>>14}},resample:function(src,dst,nw,nh){var h=src.rows,w=src.cols;h>nh&&w>nw&&(dst.resize(nw,nh,src.channel),src.type&jsfeat.U8_t&&dst.type&jsfeat.U8_t&&256>h*w/(nh*nw)?_resample_u8(src,dst,nw,nh):_resample(src,dst,nw,nh))},box_blur_gray:function(src,dst,radius,options){"undefined"==typeof options&&(options=0);var w=src.cols,h=src.rows,h2=h<<1,w2=w<<1,i=0,x=0,y=0,end=0,windowSize=(radius<<1)+1|0,radiusPlusOne=radius+1|0,radiusPlus2=radiusPlusOne+1|0,scale=options&jsfeat.BOX_BLUR_NOSCALE?1:1/(windowSize*windowSize),tmp_buff=jsfeat.cache.get_buffer(w*h<<2),sum=0,dstIndex=0,srcIndex=0,nextPixelIndex=0,previousPixelIndex=0,data_i32=tmp_buff.i32,data_u8=src.data,hold=0;for(dst.resize(w,h,src.channel),y=0;h>y;++y){for(dstIndex=y,sum=radiusPlusOne*data_u8[srcIndex],i=srcIndex+1|0,end=srcIndex+radius|0;end>=i;++i)sum+=data_u8[i];for(nextPixelIndex=srcIndex+radiusPlusOne|0,previousPixelIndex=srcIndex,hold=data_u8[previousPixelIndex],x=0;radius>x;++x,dstIndex+=h)data_i32[dstIndex]=sum,sum+=data_u8[nextPixelIndex]-hold,nextPixelIndex++;for(;w-radiusPlus2>x;x+=2,dstIndex+=h2)data_i32[dstIndex]=sum,sum+=data_u8[nextPixelIndex]-data_u8[previousPixelIndex],data_i32[dstIndex+h]=sum,sum+=data_u8[nextPixelIndex+1]-data_u8[previousPixelIndex+1],nextPixelIndex+=2,previousPixelIndex+=2;for(;w-radiusPlusOne>x;++x,dstIndex+=h)data_i32[dstIndex]=sum,sum+=data_u8[nextPixelIndex]-data_u8[previousPixelIndex],nextPixelIndex++,previousPixelIndex++;for(hold=data_u8[nextPixelIndex-1];w>x;++x,dstIndex+=h)data_i32[dstIndex]=sum,sum+=hold-data_u8[previousPixelIndex],previousPixelIndex++;srcIndex+=w}if(srcIndex=0,data_u8=dst.data,1==scale)for(y=0;w>y;++y){for(dstIndex=y,sum=radiusPlusOne*data_i32[srcIndex],i=srcIndex+1|0,end=srcIndex+radius|0;end>=i;++i)sum+=data_i32[i];for(nextPixelIndex=srcIndex+radiusPlusOne,previousPixelIndex=srcIndex,hold=data_i32[previousPixelIndex],x=0;radius>x;++x,dstIndex+=w)data_u8[dstIndex]=sum,sum+=data_i32[nextPixelIndex]-hold,nextPixelIndex++;for(;h-radiusPlus2>x;x+=2,dstIndex+=w2)data_u8[dstIndex]=sum,sum+=data_i32[nextPixelIndex]-data_i32[previousPixelIndex],data_u8[dstIndex+w]=sum,sum+=data_i32[nextPixelIndex+1]-data_i32[previousPixelIndex+1],nextPixelIndex+=2,previousPixelIndex+=2;for(;h-radiusPlusOne>x;++x,dstIndex+=w)data_u8[dstIndex]=sum,sum+=data_i32[nextPixelIndex]-data_i32[previousPixelIndex],nextPixelIndex++,previousPixelIndex++;for(hold=data_i32[nextPixelIndex-1];h>x;++x,dstIndex+=w)data_u8[dstIndex]=sum,sum+=hold-data_i32[previousPixelIndex],previousPixelIndex++;srcIndex+=h}else for(y=0;w>y;++y){for(dstIndex=y,sum=radiusPlusOne*data_i32[srcIndex],i=srcIndex+1|0,end=srcIndex+radius|0;end>=i;++i)sum+=data_i32[i];for(nextPixelIndex=srcIndex+radiusPlusOne,previousPixelIndex=srcIndex,hold=data_i32[previousPixelIndex],x=0;radius>x;++x,dstIndex+=w)data_u8[dstIndex]=sum*scale,sum+=data_i32[nextPixelIndex]-hold,nextPixelIndex++;for(;h-radiusPlus2>x;x+=2,dstIndex+=w2)data_u8[dstIndex]=sum*scale,sum+=data_i32[nextPixelIndex]-data_i32[previousPixelIndex],data_u8[dstIndex+w]=sum*scale,sum+=data_i32[nextPixelIndex+1]-data_i32[previousPixelIndex+1],nextPixelIndex+=2,previousPixelIndex+=2;for(;h-radiusPlusOne>x;++x,dstIndex+=w)data_u8[dstIndex]=sum*scale,sum+=data_i32[nextPixelIndex]-data_i32[previousPixelIndex],nextPixelIndex++,previousPixelIndex++;for(hold=data_i32[nextPixelIndex-1];h>x;++x,dstIndex+=w)data_u8[dstIndex]=sum*scale,sum+=hold-data_i32[previousPixelIndex],previousPixelIndex++;srcIndex+=h}jsfeat.cache.put_buffer(tmp_buff)},gaussian_blur:function(src,dst,kernel_size,sigma){"undefined"==typeof sigma&&(sigma=0),"undefined"==typeof kernel_size&&(kernel_size=0),kernel_size=0==kernel_size?2*Math.max(1,4*sigma+1-1e-8)+1|0:kernel_size;var half_kernel=kernel_size>>1,w=src.cols,h=src.rows,data_type=src.type,is_u8=data_type&jsfeat.U8_t;dst.resize(w,h,src.channel);var buf,filter,src_d=src.data,dst_d=dst.data,buf_sz=kernel_size+Math.max(h,w)|0,buf_node=jsfeat.cache.get_buffer(buf_sz<<2),filt_node=jsfeat.cache.get_buffer(kernel_size<<2);is_u8?(buf=buf_node.i32,filter=filt_node.i32):data_type&jsfeat.S32_t?(buf=buf_node.i32,filter=filt_node.f32):(buf=buf_node.f32,filter=filt_node.f32),jsfeat.math.get_gaussian_kernel(kernel_size,sigma,filter,data_type),is_u8?_convol_u8(buf,src_d,dst_d,w,h,filter,kernel_size,half_kernel):_convol(buf,src_d,dst_d,w,h,filter,kernel_size,half_kernel),jsfeat.cache.put_buffer(buf_node),jsfeat.cache.put_buffer(filt_node)},pyrdown:function(src,dst,sx,sy){"undefined"==typeof sx&&(sx=0),"undefined"==typeof sy&&(sy=0);var w=src.cols,h=src.rows,w2=w>>1,h2=h>>1,_w2=w2-(sx<<1),_h2=h2-(sy<<1),x=0,y=0,sptr=sx+sy*w,sline=0,dptr=0,dline=0;dst.resize(w2,h2,src.channel);var src_d=src.data,dst_d=dst.data;for(y=0;_h2>y;++y){for(sline=sptr,dline=dptr,x=0;_w2-2>=x;x+=2,dline+=2,sline+=4)dst_d[dline]=src_d[sline]+src_d[sline+1]+src_d[sline+w]+src_d[sline+w+1]+2>>2,dst_d[dline+1]=src_d[sline+2]+src_d[sline+3]+src_d[sline+w+2]+src_d[sline+w+3]+2>>2;for(;_w2>x;++x,++dline,sline+=2)dst_d[dline]=src_d[sline]+src_d[sline+1]+src_d[sline+w]+src_d[sline+w+1]+2>>2;sptr+=w<<1,dptr+=w2}},scharr_derivatives:function(src,dst){var a,b,c,d,e,f,trow0,trow1,w=src.cols,h=src.rows,dstep=w<<1,x=0,y=0,x1=0,srow0=0,srow1=0,srow2=0,drow=0;dst.resize(w,h,2);var img=src.data,gxgy=dst.data,buf0_node=jsfeat.cache.get_buffer(w+2<<2),buf1_node=jsfeat.cache.get_buffer(w+2<<2);for(src.type&jsfeat.U8_t||src.type&jsfeat.S32_t?(trow0=buf0_node.i32,trow1=buf1_node.i32):(trow0=buf0_node.f32,trow1=buf1_node.f32);h>y;++y,srow1+=w){for(srow0=(y>0?y-1:1)*w|0,srow2=(h-1>y?y+1:h-2)*w|0,drow=y*dstep|0,x=0,x1=1;w-2>=x;x+=2,x1+=2)a=img[srow0+x],b=img[srow2+x],trow0[x1]=3*(a+b)+10*img[srow1+x],trow1[x1]=b-a,a=img[srow0+x+1],b=img[srow2+x+1],trow0[x1+1]=3*(a+b)+10*img[srow1+x+1],trow1[x1+1]=b-a;for(;w>x;++x,++x1)a=img[srow0+x],b=img[srow2+x],trow0[x1]=3*(a+b)+10*img[srow1+x],trow1[x1]=b-a;for(x=w+1|0,trow0[0]=trow0[1],trow0[x]=trow0[w],trow1[0]=trow1[1],trow1[x]=trow1[w],x=0;w-4>=x;x+=4)a=trow1[x+2],b=trow1[x+1],c=trow1[x+3],d=trow1[x+4],e=trow0[x+2],f=trow0[x+3],gxgy[drow++]=e-trow0[x],gxgy[drow++]=3*(a+trow1[x])+10*b,gxgy[drow++]=f-trow0[x+1],gxgy[drow++]=3*(c+b)+10*a,gxgy[drow++]=trow0[x+4]-e,gxgy[drow++]=3*(d+a)+10*c,gxgy[drow++]=trow0[x+5]-f,gxgy[drow++]=3*(trow1[x+5]+c)+10*d;for(;w>x;++x)gxgy[drow++]=trow0[x+2]-trow0[x],gxgy[drow++]=3*(trow1[x+2]+trow1[x])+10*trow1[x+1]}jsfeat.cache.put_buffer(buf0_node),jsfeat.cache.put_buffer(buf1_node)},sobel_derivatives:function(src,dst){var a,b,c,d,e,f,trow0,trow1,w=src.cols,h=src.rows,dstep=w<<1,x=0,y=0,x1=0,srow0=0,srow1=0,srow2=0,drow=0;dst.resize(w,h,2);var img=src.data,gxgy=dst.data,buf0_node=jsfeat.cache.get_buffer(w+2<<2),buf1_node=jsfeat.cache.get_buffer(w+2<<2);for(src.type&jsfeat.U8_t||src.type&jsfeat.S32_t?(trow0=buf0_node.i32,trow1=buf1_node.i32):(trow0=buf0_node.f32,trow1=buf1_node.f32);h>y;++y,srow1+=w){for(srow0=(y>0?y-1:1)*w|0,srow2=(h-1>y?y+1:h-2)*w|0,drow=y*dstep|0,x=0,x1=1;w-2>=x;x+=2,x1+=2)a=img[srow0+x],b=img[srow2+x],trow0[x1]=a+b+2*img[srow1+x],trow1[x1]=b-a,a=img[srow0+x+1],b=img[srow2+x+1],trow0[x1+1]=a+b+2*img[srow1+x+1],trow1[x1+1]=b-a;for(;w>x;++x,++x1)a=img[srow0+x],b=img[srow2+x],trow0[x1]=a+b+2*img[srow1+x],trow1[x1]=b-a;for(x=w+1|0,trow0[0]=trow0[1],trow0[x]=trow0[w],trow1[0]=trow1[1],trow1[x]=trow1[w],x=0;w-4>=x;x+=4)a=trow1[x+2],b=trow1[x+1],c=trow1[x+3],d=trow1[x+4],e=trow0[x+2],f=trow0[x+3],gxgy[drow++]=e-trow0[x],gxgy[drow++]=a+trow1[x]+2*b,gxgy[drow++]=f-trow0[x+1],gxgy[drow++]=c+b+2*a,gxgy[drow++]=trow0[x+4]-e,gxgy[drow++]=d+a+2*c,gxgy[drow++]=trow0[x+5]-f,gxgy[drow++]=trow1[x+5]+c+2*d;for(;w>x;++x)gxgy[drow++]=trow0[x+2]-trow0[x],gxgy[drow++]=trow1[x+2]+trow1[x]+2*trow1[x+1]}jsfeat.cache.put_buffer(buf0_node),jsfeat.cache.put_buffer(buf1_node)},compute_integral_image:function(src,dst_sum,dst_sqsum,dst_tilted){var w0=0|src.cols,h0=0|src.rows,src_d=src.data,w1=w0+1|0,s=0,s2=0,p=0,pup=0,i=0,j=0,v=0,k=0;if(dst_sum&&dst_sqsum){for(;w1>i;++i)dst_sum[i]=0,dst_sqsum[i]=0;for(p=w1+1|0,pup=1,i=0,k=0;h0>i;++i,++p,++pup){for(s=s2=0,j=0;w0-2>=j;j+=2,k+=2,p+=2,pup+=2)v=src_d[k],s+=v,s2+=v*v,dst_sum[p]=dst_sum[pup]+s,dst_sqsum[p]=dst_sqsum[pup]+s2,v=src_d[k+1],s+=v,s2+=v*v,dst_sum[p+1]=dst_sum[pup+1]+s,dst_sqsum[p+1]=dst_sqsum[pup+1]+s2;for(;w0>j;++j,++k,++p,++pup)v=src_d[k],s+=v,s2+=v*v,dst_sum[p]=dst_sum[pup]+s,dst_sqsum[p]=dst_sqsum[pup]+s2}}else if(dst_sum){for(;w1>i;++i)dst_sum[i]=0;for(p=w1+1|0,pup=1,i=0,k=0;h0>i;++i,++p,++pup){for(s=0,j=0;w0-2>=j;j+=2,k+=2,p+=2,pup+=2)s+=src_d[k],dst_sum[p]=dst_sum[pup]+s,s+=src_d[k+1],dst_sum[p+1]=dst_sum[pup+1]+s;for(;w0>j;++j,++k,++p,++pup)s+=src_d[k],dst_sum[p]=dst_sum[pup]+s}}else if(dst_sqsum){for(;w1>i;++i)dst_sqsum[i]=0;for(p=w1+1|0,pup=1,i=0,k=0;h0>i;++i,++p,++pup){for(s2=0,j=0;w0-2>=j;j+=2,k+=2,p+=2,pup+=2)v=src_d[k],s2+=v*v,dst_sqsum[p]=dst_sqsum[pup]+s2,v=src_d[k+1],s2+=v*v,dst_sqsum[p+1]=dst_sqsum[pup+1]+s2;for(;w0>j;++j,++k,++p,++pup)v=src_d[k],s2+=v*v,dst_sqsum[p]=dst_sqsum[pup]+s2}}if(dst_tilted){for(i=0;w1>i;++i)dst_tilted[i]=0;for(p=w1+1|0,pup=0,i=0,k=0;h0>i;++i,++p,++pup){for(j=0;w0-2>=j;j+=2,k+=2,p+=2,pup+=2)dst_tilted[p]=src_d[k]+dst_tilted[pup],dst_tilted[p+1]=src_d[k+1]+dst_tilted[pup+1];for(;w0>j;++j,++k,++p,++pup)dst_tilted[p]=src_d[k]+dst_tilted[pup]}for(p=w1+w0|0,pup=w0,i=0;h0>i;++i,p+=w1,pup+=w1)dst_tilted[p]+=dst_tilted[pup];for(j=w0-1;j>0;--j)for(p=j+h0*w1,pup=p-w1,i=h0;i>0;--i,p-=w1,pup-=w1)dst_tilted[p]+=dst_tilted[pup]+dst_tilted[pup+1]}},equalize_histogram:function(src,dst){var w=src.cols,h=src.rows,src_d=src.data;dst.resize(w,h,src.channel);var hist0,norm,dst_d=dst.data,size=w*h,i=0,prev=0,hist0_node=jsfeat.cache.get_buffer(1024);for(hist0=hist0_node.i32;256>i;++i)hist0[i]=0;for(i=0;size>i;++i)++hist0[src_d[i]];for(prev=hist0[0],i=1;256>i;++i)prev=hist0[i]+=prev;for(norm=255/size,i=0;size>i;++i)dst_d[i]=hist0[src_d[i]]*norm+.5|0;jsfeat.cache.put_buffer(hist0_node)},canny:function(src,dst,low_thresh,high_thresh){var w=src.cols,h=src.rows;src.data;dst.resize(w,h,src.channel);var dst_d=dst.data,i=0,j=0,grad=0,w2=w<<1,_grad=0,suppress=0,f=0,x=0,y=0,s=0,tg22x=0,tg67x=0,dxdy_node=jsfeat.cache.get_buffer(h*w2<<2),buf_node=jsfeat.cache.get_buffer(3*(w+2)<<2),map_node=jsfeat.cache.get_buffer((h+2)*(w+2)<<2),stack_node=jsfeat.cache.get_buffer(h*w<<2),buf=buf_node.i32,map=map_node.i32,stack=stack_node.i32,dxdy=dxdy_node.i32,dxdy_m=new jsfeat.matrix_t(w,h,jsfeat.S32C2_t,dxdy_node.data),row0=1,row1=w+2+1|0,row2=2*(w+2)+1|0,map_w=w+2|0,map_i=map_w+1|0,stack_i=0;for(this.sobel_derivatives(src,dxdy_m),low_thresh>high_thresh&&(i=low_thresh,low_thresh=high_thresh,high_thresh=i),i=3*(w+2)|0;--i>=0;)buf[i]=0;for(i=(h+2)*(w+2)|0;--i>=0;)map[i]=0;for(;w>j;++j,grad+=2)x=dxdy[grad],y=dxdy[grad+1],buf[row1+j]=(x^x>>31)-(x>>31)+((y^y>>31)-(y>>31));for(i=1;h>=i;++i,grad+=w2){if(i==h)for(j=row2+w;--j>=row2;)buf[j]=0;else for(j=0;w>j;j++)x=dxdy[grad+(j<<1)],y=dxdy[grad+(j<<1)+1],buf[row2+j]=(x^x>>31)-(x>>31)+((y^y>>31)-(y>>31));for(_grad=grad-w2|0,map[map_i-1]=0,suppress=0,j=0;w>j;++j,_grad+=2){if(f=buf[row1+j],f>low_thresh)if(x=dxdy[_grad],y=dxdy[_grad+1],s=x^y,x=(x^x>>31)-(x>>31)|0,y=(y^y>>31)-(y>>31)|0,tg22x=13573*x,tg67x=tg22x+(x+x<<15),y<<=15,tg22x>y){if(f>buf[row1+j-1]&&f>=buf[row1+j+1]){f>high_thresh&&!suppress&&2!=map[map_i+j-map_w]?(map[map_i+j]=2,suppress=1,stack[stack_i++]=map_i+j):map[map_i+j]=1;continue}}else if(y>tg67x){if(f>buf[row0+j]&&f>=buf[row2+j]){f>high_thresh&&!suppress&&2!=map[map_i+j-map_w]?(map[map_i+j]=2,suppress=1,stack[stack_i++]=map_i+j):map[map_i+j]=1;continue}}else if(s=0>s?-1:1,f>buf[row0+j-s]&&f>buf[row2+j+s]){f>high_thresh&&!suppress&&2!=map[map_i+j-map_w]?(map[map_i+j]=2,suppress=1,stack[stack_i++]=map_i+j):map[map_i+j]=1;continue}map[map_i+j]=0,suppress=0}map[map_i+w]=0,map_i+=map_w,j=row0,row0=row1,row1=row2,row2=j}for(j=map_i-map_w-1,i=0;map_w>i;++i,++j)map[j]=0;for(;stack_i>0;)map_i=stack[--stack_i],map_i-=map_w+1,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=1,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=1,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=map_w,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i-=2,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=map_w,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=1,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i),map_i+=1,1==map[map_i]&&(map[map_i]=2,stack[stack_i++]=map_i);for(map_i=map_w+1,row0=0,i=0;h>i;++i,map_i+=map_w)for(j=0;w>j;++j)dst_d[row0++]=255*(2==map[map_i+j]);jsfeat.cache.put_buffer(dxdy_node),jsfeat.cache.put_buffer(buf_node),jsfeat.cache.put_buffer(map_node),jsfeat.cache.put_buffer(stack_node)},warp_perspective:function(src,dst,transform,fill_value){"undefined"==typeof fill_value&&(fill_value=0);for(var src_width=0|src.cols,src_height=0|src.rows,dst_width=0|dst.cols,dst_height=0|dst.rows,src_d=src.data,dst_d=dst.data,x=0,y=0,off=0,ixs=0,iys=0,xs=0,ys=0,xs0=0,ys0=0,ws=0,sc=0,a=0,b=0,p0=0,p1=0,td=transform.data,m00=td[0],m01=td[1],m02=td[2],m10=td[3],m11=td[4],m12=td[5],m20=td[6],m21=td[7],m22=td[8],dptr=0;dst_height>y;++y)for(xs0=m01*y+m02,ys0=m11*y+m12,ws=m21*y+m22,x=0;dst_width>x;++x,++dptr,xs0+=m00,ys0+=m10,ws+=m20)sc=1/ws,xs=xs0*sc,ys=ys0*sc,ixs=0|xs,iys=0|ys,xs>0&&ys>0&&src_width-1>ixs&&src_height-1>iys?(a=Math.max(xs-ixs,0),b=Math.max(ys-iys,0),off=src_width*iys+ixs|0,p0=src_d[off]+a*(src_d[off+1]-src_d[off]),p1=src_d[off+src_width]+a*(src_d[off+src_width+1]-src_d[off+src_width]),dst_d[dptr]=p0+b*(p1-p0)):dst_d[dptr]=fill_value},warp_affine:function(src,dst,transform,fill_value){"undefined"==typeof fill_value&&(fill_value=0);for(var src_width=src.cols,src_height=src.rows,dst_width=dst.cols,dst_height=dst.rows,src_d=src.data,dst_d=dst.data,x=0,y=0,off=0,ixs=0,iys=0,xs=0,ys=0,a=0,b=0,p0=0,p1=0,td=transform.data,m00=td[0],m01=td[1],m02=td[2],m10=td[3],m11=td[4],m12=td[5],dptr=0;dst_height>y;++y)for(xs=m01*y+m02,ys=m11*y+m12,x=0;dst_width>x;++x,++dptr,xs+=m00,ys+=m10)ixs=0|xs,iys=0|ys,ixs>=0&&iys>=0&&src_width-1>ixs&&src_height-1>iys?(a=xs-ixs,b=ys-iys,off=src_width*iys+ixs,p0=src_d[off]+a*(src_d[off+1]-src_d[off]),p1=src_d[off+src_width]+a*(src_d[off+src_width+1]-src_d[off+src_width]),dst_d[dptr]=p0+b*(p1-p0)):dst_d[dptr]=fill_value},skindetector:function(src,dst){for(var r,g,b,j,i=src.width*src.height;i--;)j=4*i,r=src.data[j],g=src.data[j+1],b=src.data[j+2],r>95&&g>40&&b>20&&r>g&&r>b&&r-Math.min(g,b)>15&&Math.abs(r-g)>15?dst[i]=255:dst[i]=0}}}();global.imgproc=imgproc}(jsfeat),function(global){"use strict";var fast_corners=function(){var offsets16=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),threshold_tab=new Uint8Array(512),pixel_off=new Int32Array(25),score_diff=new Int32Array(25),_cmp_offsets=function(pixel,step,pattern_size){for(var k=0,offsets=offsets16;pattern_size>k;++k)pixel[k]=offsets[k<<1]+offsets[(k<<1)+1]*step;for(;25>k;++k)pixel[k]=pixel[k-pattern_size]},_cmp_score_16=function(src,off,pixel,d,threshold){for(var N=25,k=0,v=src[off],a0=threshold,a=0,b0=0,b=0;N>k;++k)d[k]=v-src[off+pixel[k]];for(k=0;16>k;k+=2)a=Math.min(d[k+1],d[k+2]),a=Math.min(a,d[k+3]),a0>=a||(a=Math.min(a,d[k+4]),a=Math.min(a,d[k+5]),a=Math.min(a,d[k+6]),a=Math.min(a,d[k+7]),a=Math.min(a,d[k+8]),a0=Math.max(a0,Math.min(a,d[k])),a0=Math.max(a0,Math.min(a,d[k+9])));for(b0=-a0,k=0;16>k;k+=2)b=Math.max(d[k+1],d[k+2]),b=Math.max(b,d[k+3]),b=Math.max(b,d[k+4]),b=Math.max(b,d[k+5]),b>=b0||(b=Math.max(b,d[k+6]),b=Math.max(b,d[k+7]),b=Math.max(b,d[k+8]),b0=Math.min(b0,Math.max(b,d[k])),b0=Math.min(b0,Math.max(b,d[k+9])));return-b0-1},_threshold=20;return{set_threshold:function(threshold){_threshold=Math.min(Math.max(threshold,0),255);for(var i=-255;255>=i;++i)threshold_tab[i+255]=-_threshold>i?1:i>_threshold?2:0;return _threshold},detect:function(src,corners,border){"undefined"==typeof border&&(border=3);var pt,K=8,N=25,img=src.data,w=src.cols,h=src.rows,i=0,j=0,k=0,vt=0,x=0,m3=0,buf_node=jsfeat.cache.get_buffer(3*w),cpbuf_node=jsfeat.cache.get_buffer(3*(w+1)<<2),buf=buf_node.u8,cpbuf=cpbuf_node.i32,pixel=pixel_off,sd=score_diff,sy=Math.max(3,border),ey=Math.min(h-2,h-border),sx=Math.max(3,border),ex=Math.min(w-3,w-border),_count=0,corners_cnt=0,score_func=_cmp_score_16,thresh_tab=threshold_tab,threshold=_threshold,v=0,tab=0,d=0,ncorners=0,cornerpos=0,curr=0,ptr=0,prev=0,pprev=0,jp1=0,jm1=0,score=0;_cmp_offsets(pixel,w,16);var pixel0=pixel[0],pixel1=pixel[1],pixel2=pixel[2],pixel3=pixel[3],pixel4=pixel[4],pixel5=pixel[5],pixel6=pixel[6],pixel7=pixel[7],pixel8=pixel[8],pixel9=pixel[9],pixel10=pixel[10],pixel11=pixel[11],pixel12=pixel[12],pixel13=pixel[13],pixel14=pixel[14],pixel15=pixel[15];for(i=0;3*w>i;++i)buf[i]=0;for(i=sy;ey>i;++i){for(ptr=i*w+sx|0,m3=(i-3)%3,curr=m3*w|0,cornerpos=m3*(w+1)|0,j=0;w>j;++j)buf[curr+j]=0;if(ncorners=0,ey-1>i)for(j=sx;ex>j;++j,++ptr)if(v=img[ptr],tab=-v+255,d=thresh_tab[tab+img[ptr+pixel0]]|thresh_tab[tab+img[ptr+pixel8]],0!=d&&(d&=thresh_tab[tab+img[ptr+pixel2]]|thresh_tab[tab+img[ptr+pixel10]],d&=thresh_tab[tab+img[ptr+pixel4]]|thresh_tab[tab+img[ptr+pixel12]],d&=thresh_tab[tab+img[ptr+pixel6]]|thresh_tab[tab+img[ptr+pixel14]],0!=d)){if(d&=thresh_tab[tab+img[ptr+pixel1]]|thresh_tab[tab+img[ptr+pixel9]],d&=thresh_tab[tab+img[ptr+pixel3]]|thresh_tab[tab+img[ptr+pixel11]],d&=thresh_tab[tab+img[ptr+pixel5]]|thresh_tab[tab+img[ptr+pixel13]],d&=thresh_tab[tab+img[ptr+pixel7]]|thresh_tab[tab+img[ptr+pixel15]],1&d)for(vt=v-threshold,_count=0,k=0;N>k;++k)if(x=img[ptr+pixel[k]],vt>x){if(++_count,_count>K){++ncorners,cpbuf[cornerpos+ncorners]=j,buf[curr+j]=score_func(img,ptr,pixel,sd,threshold);break}}else _count=0;if(2&d)for(vt=v+threshold,_count=0,k=0;N>k;++k)if(x=img[ptr+pixel[k]],x>vt){if(++_count,_count>K){++ncorners,cpbuf[cornerpos+ncorners]=j,buf[curr+j]=score_func(img,ptr,pixel,sd,threshold);break}}else _count=0}if(cpbuf[cornerpos+w]=ncorners,i!=sy)for(m3=(i-4+3)%3,prev=m3*w|0,cornerpos=m3*(w+1)|0,m3=(i-5+3)%3,pprev=m3*w|0,ncorners=cpbuf[cornerpos+w],k=0;ncorners>k;++k)j=cpbuf[cornerpos+k],jp1=j+1|0,jm1=j-1|0,score=buf[prev+j],score>buf[prev+jp1]&&score>buf[prev+jm1]&&score>buf[pprev+jm1]&&score>buf[pprev+j]&&score>buf[pprev+jp1]&&score>buf[curr+jm1]&&score>buf[curr+j]&&score>buf[curr+jp1]&&(pt=corners[corners_cnt],pt.x=j,pt.y=i-1,pt.score=score,corners_cnt++)}return jsfeat.cache.put_buffer(buf_node),jsfeat.cache.put_buffer(cpbuf_node),corners_cnt}}}();global.fast_corners=fast_corners,fast_corners.set_threshold(20)}(jsfeat),function(global){"use strict";var yape06=function(){var compute_laplacian=function(src,dst,w,h,Dxx,Dyy,sx,sy,ex,ey){var y=0,x=0,yrow=sy*w+sx|0,row=yrow;for(y=sy;ey>y;++y,yrow+=w,row=yrow)for(x=sx;ex>x;++x,++row)dst[row]=-4*src[row]+src[row+Dxx]+src[row-Dxx]+src[row+Dyy]+src[row-Dyy]},hessian_min_eigen_value=function(src,off,tr,Dxx,Dyy,Dxy,Dyx){var Ixx=-2*src[off]+src[off+Dxx]+src[off-Dxx],Iyy=-2*src[off]+src[off+Dyy]+src[off-Dyy],Ixy=src[off+Dxy]+src[off-Dxy]-src[off+Dyx]-src[off-Dyx],sqrt_delta=0|Math.sqrt((Ixx-Iyy)*(Ixx-Iyy)+4*Ixy*Ixy);return Math.min(Math.abs(tr-sqrt_delta),Math.abs(-(tr+sqrt_delta)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(src,points,border){"undefined"==typeof border&&(border=5);var pt,x=0,y=0,w=src.cols,h=src.rows,srd_d=src.data,Dxx=5,Dyy=5*w|0,Dxy=3+3*w|0,Dyx=3-3*w|0,lap_buf=jsfeat.cache.get_buffer(w*h<<2),laplacian=lap_buf.i32,lv=0,row=0,rowx=0,min_eigen_value=0,number_of_points=0,lap_thresh=this.laplacian_threshold,eigen_thresh=this.min_eigen_value_threshold,sx=0|Math.max(5,border),sy=0|Math.max(3,border),ex=0|Math.min(w-5,w-border),ey=0|Math.min(h-3,h-border);for(x=w*h;--x>=0;)laplacian[x]=0;for(compute_laplacian(srd_d,laplacian,w,h,Dxx,Dyy,sx,sy,ex,ey),row=sy*w+sx|0,y=sy;ey>y;++y,row+=w)for(x=sx,rowx=row;ex>x;++x,++rowx)lv=laplacian[rowx],(-lap_thresh>lv&&lv<laplacian[rowx-1]&&lv<laplacian[rowx+1]&&lv<laplacian[rowx-w]&&lv<laplacian[rowx+w]&&lv<laplacian[rowx-w-1]&&lv<laplacian[rowx+w-1]&&lv<laplacian[rowx-w+1]&&lv<laplacian[rowx+w+1]||lv>lap_thresh&&lv>laplacian[rowx-1]&&lv>laplacian[rowx+1]&&lv>laplacian[rowx-w]&&lv>laplacian[rowx+w]&&lv>laplacian[rowx-w-1]&&lv>laplacian[rowx+w-1]&&lv>laplacian[rowx-w+1]&&lv>laplacian[rowx+w+1])&&(min_eigen_value=hessian_min_eigen_value(srd_d,rowx,lv,Dxx,Dyy,Dxy,Dyx),min_eigen_value>eigen_thresh&&(pt=points[number_of_points],pt.x=x,pt.y=y,pt.score=min_eigen_value,++number_of_points,++x,++rowx));return jsfeat.cache.put_buffer(lap_buf),number_of_points}}}();global.yape06=yape06}(jsfeat),function(global){"use strict";var yape=function(){var precompute_directions=function(step,dirs,R){var x,y,i=0;for(x=R,y=0;x>y;y++,i++)x=Math.sqrt(R*R-y*y)+.5|0,dirs[i]=x+step*y;for(x--;y>x&&x>=0;x--,i++)y=Math.sqrt(R*R-x*x)+.5|0,dirs[i]=x+step*y;for(;y>-x;x--,i++)y=Math.sqrt(R*R-x*x)+.5|0,dirs[i]=x+step*y;for(y--;y>=0;y--,i++)x=-Math.sqrt(R*R-y*y)-.5|0,dirs[i]=x+step*y;for(;y>x;y--,i++)x=-Math.sqrt(R*R-y*y)-.5|0,dirs[i]=x+step*y;for(x++;0>=x;x++,i++)y=-Math.sqrt(R*R-x*x)-.5|0,dirs[i]=x+step*y;for(;-y>x;x++,i++)y=-Math.sqrt(R*R-x*x)-.5|0,dirs[i]=x+step*y;for(y++;0>y;y++,i++)x=Math.sqrt(R*R-y*y)+.5|0,dirs[i]=x+step*y;return dirs[i]=dirs[0],dirs[i+1]=dirs[1],i},third_check=function(Sb,off,step){var n=0;return 0!=Sb[off+1]&&n++,0!=Sb[off-1]&&n++,0!=Sb[off+step]&&n++,0!=Sb[off+step+1]&&n++,0!=Sb[off+step-1]&&n++,0!=Sb[off-step]&&n++,0!=Sb[off-step+1]&&n++,0!=Sb[off-step-1]&&n++,n},is_local_maxima=function(p,off,v,step,neighborhood){var x,y;if(v>0)for(off-=step*neighborhood,y=-neighborhood;neighborhood>=y;++y){for(x=-neighborhood;neighborhood>=x;++x)if(p[off+x]>v)return!1;off+=step}else for(off-=step*neighborhood,y=-neighborhood;neighborhood>=y;++y){for(x=-neighborhood;neighborhood>=x;++x)if(p[off+x]<v)return!1;off+=step}return!0},perform_one_point=function(I,x,Scores,Im,Ip,dirs,opposite,dirs_nb){var score=0,a=0,b=opposite-1|0,A=0,B0=0,B1=0,B2=0,state=0;if(A=I[x+dirs[a]],Ip>=A)if(A>=Im)if(B0=I[x+dirs[b]],Ip>=B0){if(B0>=Im)return void(Scores[x]=0);if(b++,B1=I[x+dirs[b]],B1>Ip)if(b++,B2=I[x+dirs[b]],B2>Ip)state=3;else{if(!(Im>B2))return void(Scores[x]=0);
state=6}else if(b++,B2=I[x+dirs[b]],B2>Ip)state=7;else{if(!(Im>B2))return void(Scores[x]=0);state=2}}else if(b++,B1=I[x+dirs[b]],B1>Ip)if(b++,B2=I[x+dirs[b]],B2>Ip)state=3;else{if(!(Im>B2))return void(Scores[x]=0);state=6}else{if(!(Im>B1))return void(Scores[x]=0);if(b++,B2=I[x+dirs[b]],B2>Ip)state=7;else{if(!(Im>B2))return void(Scores[x]=0);state=2}}else{if(B0=I[x+dirs[b]],B0>Ip)return void(Scores[x]=0);if(b++,B1=I[x+dirs[b]],B1>Ip)return void(Scores[x]=0);if(b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);state=1}else{if(B0=I[x+dirs[b]],Im>B0)return void(Scores[x]=0);if(b++,B1=I[x+dirs[b]],Im>B1)return void(Scores[x]=0);if(b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);state=0}for(a=1;opposite>=a;a++)switch(A=I[x+dirs[a]],state){case 0:if(A>Ip){if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);score-=A+B1,state=0;break}if(Im>A){if(B1>Ip)return void(Scores[x]=0);if(B2>Ip)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);score-=A+B1,state=8;break}if(Ip>=B1)return void(Scores[x]=0);if(Ip>=B2)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip){score-=A+B1,state=3;break}if(Im>B2){score-=A+B1,state=6;break}return void(Scores[x]=0);case 1:if(Im>A){if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);score-=A+B1,state=1;break}if(A>Ip){if(Im>B1)return void(Scores[x]=0);if(Im>B2)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);score-=A+B1,state=9;break}if(B1>=Im)return void(Scores[x]=0);if(B2>=Im)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2){score-=A+B1,state=2;break}if(B2>Ip){score-=A+B1,state=7;break}return void(Scores[x]=0);case 2:if(A>Ip)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>A){if(B2>Ip)return void(Scores[x]=0);score-=A+B1,state=4;break}if(B2>Ip){score-=A+B1,state=7;break}if(Im>B2){score-=A+B1,state=2;break}return void(Scores[x]=0);case 3:if(Im>A)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],A>Ip){if(Im>B2)return void(Scores[x]=0);score-=A+B1,state=5;break}if(B2>Ip){score-=A+B1,state=3;break}if(Im>B2){score-=A+B1,state=6;break}return void(Scores[x]=0);case 4:if(A>Ip)return void(Scores[x]=0);if(Im>A){if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);score-=A+B1,state=1;break}if(B2>=Im)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2){score-=A+B1,state=2;break}if(B2>Ip){score-=A+B1,state=7;break}return void(Scores[x]=0);case 5:if(Im>A)return void(Scores[x]=0);if(A>Ip){if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);score-=A+B1,state=0;break}if(Ip>=B2)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip){score-=A+B1,state=3;break}if(Im>B2){score-=A+B1,state=6;break}return void(Scores[x]=0);case 7:if(A>Ip)return void(Scores[x]=0);if(Im>A)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip){score-=A+B1,state=3;break}if(Im>B2){score-=A+B1,state=6;break}return void(Scores[x]=0);case 6:if(A>Ip)return void(Scores[x]=0);if(Im>A)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2){score-=A+B1,state=2;break}if(B2>Ip){score-=A+B1,state=7;break}return void(Scores[x]=0);case 8:if(A>Ip){if(Im>B2)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);score-=A+B1,state=9;break}if(Im>A){if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);score-=A+B1,state=1;break}return void(Scores[x]=0);case 9:if(Im>A){if(B2>Ip)return void(Scores[x]=0);if(B1=B2,b++,B2=I[x+dirs[b]],B2>Ip)return void(Scores[x]=0);score-=A+B1,state=8;break}if(A>Ip){if(B1=B2,b++,B2=I[x+dirs[b]],Im>B2)return void(Scores[x]=0);score-=A+B1,state=0;break}return void(Scores[x]=0)}Scores[x]=score+dirs_nb*I[x]},lev_table_t=function(){function lev_table_t(w,h,r){this.dirs=new Int32Array(1024),this.dirs_count=0|precompute_directions(w,this.dirs,r),this.scores=new Int32Array(w*h),this.radius=0|r}return lev_table_t}();return{level_tables:[],tau:7,init:function(width,height,radius,pyramid_levels){"undefined"==typeof pyramid_levels&&(pyramid_levels=1);var i;for(radius=Math.min(radius,7),radius=Math.max(radius,3),i=0;pyramid_levels>i;++i)this.level_tables[i]=new lev_table_t(width>>i,height>>i,radius)},detect:function(src,points,border){"undefined"==typeof border&&(border=4);var pt,t=this.level_tables[0],R=0|t.radius,Rm1=R-1|0,dirs=t.dirs,dirs_count=0|t.dirs_count,opposite=dirs_count>>1,img=src.data,w=0|src.cols,h=0|src.rows,hw=w>>1,scores=t.scores,x=0,y=0,row=0,rowx=0,ip=0,im=0,abs_score=0,score=0,tau=0|this.tau,number_of_points=0,sx=0|Math.max(R+1,border),sy=0|Math.max(R+1,border),ex=0|Math.min(w-R-2,w-border),ey=0|Math.min(h-R-2,h-border);for(row=sy*w+sx|0,y=sy;ey>y;++y,row+=w)for(x=sx,rowx=row;ex>x;++x,++rowx)ip=img[rowx]+tau,im=img[rowx]-tau,im<img[rowx+R]&&img[rowx+R]<ip&&im<img[rowx-R]&&img[rowx-R]<ip?scores[rowx]=0:perform_one_point(img,rowx,scores,im,ip,dirs,opposite,dirs_count);for(row=sy*w+sx|0,y=sy;ey>y;++y,row+=w)for(x=sx,rowx=row;ex>x;++x,++rowx)score=scores[rowx],abs_score=Math.abs(score),5>abs_score?(++x,++rowx):third_check(scores,rowx,w)>=3&&is_local_maxima(scores,rowx,score,hw,R)&&(pt=points[number_of_points],pt.x=x,pt.y=y,pt.score=abs_score,++number_of_points,x+=Rm1,rowx+=Rm1);return number_of_points}}}();global.yape=yape}(jsfeat),function(global){"use strict";var orb=function(){var bit_pattern_31_=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),H=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),patch_img=new jsfeat.matrix_t(32,32,jsfeat.U8_t|jsfeat.C1_t),rectify_patch=function(src,dst,angle,px,py,psize){var cosine=Math.cos(angle),sine=Math.sin(angle);H.data[0]=cosine,H.data[1]=-sine,H.data[2]=(-cosine+sine)*psize*.5+px,H.data[3]=sine,H.data[4]=cosine,H.data[5]=(-sine-cosine)*psize*.5+py,jsfeat.imgproc.warp_affine(src,dst,H,128)};return{describe:function(src,corners,count,descriptors){var DESCR_SIZE=32,i=0,b=0,px=0,py=0,angle=0,t0=0,t1=0,val=0,patch_d=(src.data,src.cols,src.rows,patch_img.data),patch_off=528,patt=0;descriptors.type&jsfeat.U8_t?descriptors.resize(DESCR_SIZE,count,1):(descriptors.type=jsfeat.U8_t,descriptors.cols=DESCR_SIZE,descriptors.rows=count,descriptors.channel=1,descriptors.allocate());var descr_d=descriptors.data,descr_off=0;for(i=0;count>i;++i){for(px=corners[i].x,py=corners[i].y,angle=corners[i].angle,rectify_patch(src,patch_img,angle,px,py,32),patt=0,b=0;DESCR_SIZE>b;++b)t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val=t1>t0|0,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<1,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<2,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<3,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<4,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<5,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<6,t0=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,t1=patch_d[patch_off+32*bit_pattern_31_[patt+1]+bit_pattern_31_[patt]],patt+=2,val|=(t1>t0)<<7,descr_d[descr_off+b]=val;descr_off+=DESCR_SIZE}}}}();global.orb=orb}(jsfeat),function(global){"use strict";var optical_flow_lk=function(){var scharr_deriv=jsfeat.imgproc.scharr_derivatives;return{track:function(prev_pyr,curr_pyr,prev_xy,curr_xy,count,win_size,max_iter,status,eps,min_eigen_threshold){"undefined"==typeof max_iter&&(max_iter=30),"undefined"==typeof status&&(status=new Uint8Array(count)),"undefined"==typeof eps&&(eps=.01),"undefined"==typeof min_eigen_threshold&&(min_eigen_threshold=1e-4);var half_win=.5*(win_size-1),win_area=win_size*win_size|0,win_area2=win_area<<1,prev_imgs=prev_pyr.data,next_imgs=curr_pyr.data,img_prev=prev_imgs[0].data,img_next=next_imgs[0].data,w0=prev_imgs[0].cols,h0=prev_imgs[0].rows,lw=0,lh=0,iwin_node=jsfeat.cache.get_buffer(win_area<<2),deriv_iwin_node=jsfeat.cache.get_buffer(win_area2<<2),deriv_lev_node=jsfeat.cache.get_buffer(h0*(w0<<1)<<2),deriv_m=new jsfeat.matrix_t(w0,h0,jsfeat.S32C2_t,deriv_lev_node.data),iwin_buf=iwin_node.i32,deriv_iwin=deriv_iwin_node.i32,deriv_lev=deriv_lev_node.i32,dstep=0,src=0,dsrc=0,iptr=0,diptr=0,jptr=0,lev_sc=0,prev_x=0,prev_y=0,next_x=0,next_y=0,prev_delta_x=0,prev_delta_y=0,delta_x=0,delta_y=0,iprev_x=0,iprev_y=0,inext_x=0,inext_y=0,i=0,j=0,x=0,y=0,level=0,ptid=0,iter=0,brd_tl=0,brd_r=0,brd_b=0,a=0,b=0,b1=0,b2=0,W_BITS14=14,W_BITS4=14,W_BITS1m5=W_BITS4-5,W_BITS1m51=1<<W_BITS1m5-1,W_BITS14_=1<<W_BITS14,W_BITS41=1<<W_BITS4-1,FLT_SCALE=1/(1<<20),iw00=0,iw01=0,iw10=0,iw11=0,ival=0,ixval=0,iyval=0,A11=0,A12=0,A22=0,D=0,min_eig=0,FLT_EPSILON=1.1920929e-7;for(eps*=eps;count>i;++i)status[i]=1;var max_level=prev_pyr.levels-1|0;for(level=max_level;level>=0;--level)for(lev_sc=1/(1<<level),lw=w0>>level,lh=h0>>level,dstep=lw<<1,img_prev=prev_imgs[level].data,img_next=next_imgs[level].data,brd_r=lw-win_size|0,brd_b=lh-win_size|0,scharr_deriv(prev_imgs[level],deriv_m),ptid=0;count>ptid;++ptid)if(i=ptid<<1,j=i+1,prev_x=prev_xy[i]*lev_sc,prev_y=prev_xy[j]*lev_sc,level==max_level?(next_x=prev_x,next_y=prev_y):(next_x=2*curr_xy[i],next_y=2*curr_xy[j]),curr_xy[i]=next_x,curr_xy[j]=next_y,prev_x-=half_win,prev_y-=half_win,iprev_x=0|prev_x,iprev_y=0|prev_y,x=brd_tl>=iprev_x|iprev_x>=brd_r|brd_tl>=iprev_y|iprev_y>=brd_b,0==x){for(a=prev_x-iprev_x,b=prev_y-iprev_y,iw00=(1-a)*(1-b)*W_BITS14_+.5|0,iw01=a*(1-b)*W_BITS14_+.5|0,iw10=(1-a)*b*W_BITS14_+.5|0,iw11=W_BITS14_-iw00-iw01-iw10,A11=0,A12=0,A22=0,y=0;win_size>y;++y)for(src=(y+iprev_y)*lw+iprev_x|0,dsrc=src<<1,iptr=y*win_size|0,diptr=iptr<<1,x=0;win_size>x;++x,++src,++iptr,dsrc+=2)ival=img_prev[src]*iw00+img_prev[src+1]*iw01+img_prev[src+lw]*iw10+img_prev[src+lw+1]*iw11,ival=ival+W_BITS1m51>>W_BITS1m5,ixval=deriv_lev[dsrc]*iw00+deriv_lev[dsrc+2]*iw01+deriv_lev[dsrc+dstep]*iw10+deriv_lev[dsrc+dstep+2]*iw11,ixval=ixval+W_BITS41>>W_BITS4,iyval=deriv_lev[dsrc+1]*iw00+deriv_lev[dsrc+3]*iw01+deriv_lev[dsrc+dstep+1]*iw10+deriv_lev[dsrc+dstep+3]*iw11,iyval=iyval+W_BITS41>>W_BITS4,iwin_buf[iptr]=ival,deriv_iwin[diptr++]=ixval,deriv_iwin[diptr++]=iyval,A11+=ixval*ixval,A12+=ixval*iyval,A22+=iyval*iyval;if(A11*=FLT_SCALE,A12*=FLT_SCALE,A22*=FLT_SCALE,D=A11*A22-A12*A12,min_eig=(A22+A11-Math.sqrt((A11-A22)*(A11-A22)+4*A12*A12))/win_area2,min_eigen_threshold>min_eig||FLT_EPSILON>D)0==level&&(status[ptid]=0);else for(D=1/D,next_x-=half_win,next_y-=half_win,prev_delta_x=0,prev_delta_y=0,iter=0;max_iter>iter;++iter){if(inext_x=0|next_x,inext_y=0|next_y,x=brd_tl>=inext_x|inext_x>=brd_r|brd_tl>=inext_y|inext_y>=brd_b,0!=x){0==level&&(status[ptid]=0);break}for(a=next_x-inext_x,b=next_y-inext_y,iw00=(1-a)*(1-b)*W_BITS14_+.5|0,iw01=a*(1-b)*W_BITS14_+.5|0,iw10=(1-a)*b*W_BITS14_+.5|0,iw11=W_BITS14_-iw00-iw01-iw10,b1=0,b2=0,y=0;win_size>y;++y)for(jptr=(y+inext_y)*lw+inext_x|0,iptr=y*win_size|0,diptr=iptr<<1,x=0;win_size>x;++x,++jptr,++iptr)ival=img_next[jptr]*iw00+img_next[jptr+1]*iw01+img_next[jptr+lw]*iw10+img_next[jptr+lw+1]*iw11,ival=ival+W_BITS1m51>>W_BITS1m5,ival-=iwin_buf[iptr],b1+=ival*deriv_iwin[diptr++],b2+=ival*deriv_iwin[diptr++];if(b1*=FLT_SCALE,b2*=FLT_SCALE,delta_x=(A12*b2-A22*b1)*D,delta_y=(A12*b1-A11*b2)*D,next_x+=delta_x,next_y+=delta_y,curr_xy[i]=next_x+half_win,curr_xy[j]=next_y+half_win,eps>=delta_x*delta_x+delta_y*delta_y)break;if(iter>0&&Math.abs(delta_x+prev_delta_x)<.01&&Math.abs(delta_y+prev_delta_y)<.01){curr_xy[i]-=.5*delta_x,curr_xy[j]-=.5*delta_y;break}prev_delta_x=delta_x,prev_delta_y=delta_y}}else 0==level&&(status[ptid]=0);jsfeat.cache.put_buffer(iwin_node),jsfeat.cache.put_buffer(deriv_iwin_node),jsfeat.cache.put_buffer(deriv_lev_node)}}}();global.optical_flow_lk=optical_flow_lk}(jsfeat),function(global){"use strict";var haar=function(){var _group_func=function(r1,r2){var distance=.25*r1.width+.5|0;return r2.x<=r1.x+distance&&r2.x>=r1.x-distance&&r2.y<=r1.y+distance&&r2.y>=r1.y-distance&&r2.width<=1.5*r1.width+.5|0&&1.5*r2.width+.5|0>=r1.width};return{edges_density:.07,detect_single_scale:function(int_sum,int_sqsum,int_tilted,int_canny_sum,width,height,scale,classifier){var i,j,k,x,y,edge_dens,mean,variance,std,stages,stage,trees,tree,sn,tn,fn,stage_thresh,stage_sum,tree_sum,feature,features,fi_a,fi_b,fi_c,fw,fh,win_w=classifier.size[0]*scale|0,win_h=classifier.size[1]*scale|0,step_x=.5*scale+1.5|0,step_y=step_x,ex=width-win_w|0,ey=height-win_h|0,w1=width+1|0,inv_area=1/(win_w*win_h),found=!0,ii_a=0,ii_b=win_w,ii_c=win_h*w1,ii_d=ii_c+win_w,edges_thresh=win_w*win_h*255*this.edges_density|0,rects=[];for(y=0;ey>y;y+=step_y)for(ii_a=y*w1,x=0;ex>x;x+=step_x,ii_a+=step_x)if(mean=int_sum[ii_a]-int_sum[ii_a+ii_b]-int_sum[ii_a+ii_c]+int_sum[ii_a+ii_d],int_canny_sum&&(edge_dens=int_canny_sum[ii_a]-int_canny_sum[ii_a+ii_b]-int_canny_sum[ii_a+ii_c]+int_canny_sum[ii_a+ii_d],edges_thresh>edge_dens||20>mean))x+=step_x,ii_a+=step_x;else{for(mean*=inv_area,variance=(int_sqsum[ii_a]-int_sqsum[ii_a+ii_b]-int_sqsum[ii_a+ii_c]+int_sqsum[ii_a+ii_d])*inv_area-mean*mean,std=variance>0?Math.sqrt(variance):1,stages=classifier.complexClassifiers,sn=stages.length,found=!0,i=0;sn>i;++i){for(stage=stages[i],stage_thresh=stage.threshold,trees=stage.simpleClassifiers,tn=trees.length,stage_sum=0,j=0;tn>j;++j){if(tree=trees[j],tree_sum=0,features=tree.features,fn=features.length,1===tree.tilted)for(k=0;fn>k;++k)feature=features[k],fi_a=~~(x+feature[0]*scale)+~~(y+feature[1]*scale)*w1,fw=~~(feature[2]*scale),fh=~~(feature[3]*scale),fi_b=fw*w1,fi_c=fh*w1,tree_sum+=(int_tilted[fi_a]-int_tilted[fi_a+fw+fi_b]-int_tilted[fi_a-fh+fi_c]+int_tilted[fi_a+fw-fh+fi_b+fi_c])*feature[4];else for(k=0;fn>k;++k)feature=features[k],fi_a=~~(x+feature[0]*scale)+~~(y+feature[1]*scale)*w1,fw=~~(feature[2]*scale),fh=~~(feature[3]*scale),fi_c=fh*w1,tree_sum+=(int_sum[fi_a]-int_sum[fi_a+fw]-int_sum[fi_a+fi_c]+int_sum[fi_a+fi_c+fw])*feature[4];stage_sum+=tree_sum*inv_area<tree.threshold*std?tree.left_val:tree.right_val}if(stage_thresh>stage_sum){found=!1;break}}found&&(rects.push({x:x,y:y,width:win_w,height:win_h,neighbor:1,confidence:stage_sum}),x+=step_x,ii_a+=step_x)}return rects},detect_multi_scale:function(int_sum,int_sqsum,int_tilted,int_canny_sum,width,height,classifier,scale_factor,scale_min){"undefined"==typeof scale_factor&&(scale_factor=1.2),"undefined"==typeof scale_min&&(scale_min=1);for(var win_w=classifier.size[0],win_h=classifier.size[1],rects=[];width>scale_min*win_w&&height>scale_min*win_h;)rects=rects.concat(this.detect_single_scale(int_sum,int_sqsum,int_tilted,int_canny_sum,width,height,scale_min,classifier)),scale_min*=scale_factor;return rects},group_rectangles:function(rects,min_neighbors){"undefined"==typeof min_neighbors&&(min_neighbors=1);var i,j,n=rects.length,node=[];for(i=0;n>i;++i)node[i]={parent:-1,element:rects[i],rank:0};for(i=0;n>i;++i)if(node[i].element){for(var root=i;-1!=node[root].parent;)root=node[root].parent;for(j=0;n>j;++j)if(i!=j&&node[j].element&&_group_func(node[i].element,node[j].element)){for(var root2=j;-1!=node[root2].parent;)root2=node[root2].parent;if(root2!=root){node[root].rank>node[root2].rank?node[root2].parent=root:(node[root].parent=root2,node[root].rank==node[root2].rank&&node[root2].rank++,root=root2);for(var temp,node2=j;-1!=node[node2].parent;)temp=node2,node2=node[node2].parent,node[temp].parent=root;for(node2=i;-1!=node[node2].parent;)temp=node2,node2=node[node2].parent,node[temp].parent=root}}}var idx_seq=[],class_idx=0;for(i=0;n>i;i++){j=-1;var node1=i;if(node[node1].element){for(;-1!=node[node1].parent;)node1=node[node1].parent;node[node1].rank>=0&&(node[node1].rank=~class_idx++),j=~node[node1].rank}idx_seq[i]=j}var comps=[];for(i=0;class_idx+1>i;++i)comps[i]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(i=0;n>i;++i){var r1=rects[i],idx=idx_seq[i];0==comps[idx].neighbors&&(comps[idx].confidence=r1.confidence),++comps[idx].neighbors,comps[idx].x+=r1.x,comps[idx].y+=r1.y,comps[idx].width+=r1.width,comps[idx].height+=r1.height,comps[idx].confidence=Math.max(comps[idx].confidence,r1.confidence)}var seq2=[];for(i=0;class_idx>i;++i)n=comps[i].neighbors,n>=min_neighbors&&seq2.push({x:(2*comps[i].x+n)/(2*n),y:(2*comps[i].y+n)/(2*n),width:(2*comps[i].width+n)/(2*n),height:(2*comps[i].height+n)/(2*n),neighbors:comps[i].neighbors,confidence:comps[i].confidence});var result_seq=[];for(n=seq2.length,i=0;n>i;++i){var r1=seq2[i],flag=!0;for(j=0;n>j;++j){var r2=seq2[j],distance=.25*r2.width+.5|0;if(i!=j&&r1.x>=r2.x-distance&&r1.y>=r2.y-distance&&r1.x+r1.width<=r2.x+r2.width+distance&&r1.y+r1.height<=r2.y+r2.height+distance&&(r2.neighbors>Math.max(3,r1.neighbors)||r1.neighbors<3)){flag=!1;break}}flag&&result_seq.push(r1)}return result_seq}}}();global.haar=haar}(jsfeat),function(global){"use strict";var bbf=function(){var _group_func=function(r1,r2){var distance=.25*r1.width+.5|0;return r2.x<=r1.x+distance&&r2.x>=r1.x-distance&&r2.y<=r1.y+distance&&r2.y>=r1.y-distance&&r2.width<=1.5*r1.width+.5|0&&1.5*r2.width+.5|0>=r1.width},img_pyr=new jsfeat.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(cascade){for(var sn=cascade.stage_classifier.length,j=0;sn>j;j++)for(var orig_feature=cascade.stage_classifier[j].feature,f_cnt=cascade.stage_classifier[j].count,feature=cascade.stage_classifier[j]._feature=new Array(f_cnt),k=0;f_cnt>k;k++)feature[k]={size:orig_feature[k].size,px:new Array(orig_feature[k].size),pz:new Array(orig_feature[k].size),nx:new Array(orig_feature[k].size),nz:new Array(orig_feature[k].size)}},build_pyramid:function(src,min_width,min_height,interval){"undefined"==typeof interval&&(interval=4);var sw=src.cols,sh=src.rows,i=0,nw=0,nh=0,new_pyr=!1,src0=src,src1=src,data_type=jsfeat.U8_t|jsfeat.C1_t;this.interval=interval,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(sw/min_width,sh/min_height))/Math.log(this.scale)|0;var pyr_l=4*(this.scale_to+2*this.next)|0;for(img_pyr.levels!=pyr_l&&(img_pyr.levels=pyr_l,img_pyr.data=new Array(pyr_l),new_pyr=!0,img_pyr.data[0]=src),i=1;i<=this.interval;++i)nw=sw/Math.pow(this.scale,i)|0,nh=sh/Math.pow(this.scale,i)|0,src0=img_pyr.data[i<<2],(new_pyr||nw!=src0.cols||nh!=src0.rows)&&(img_pyr.data[i<<2]=new jsfeat.matrix_t(nw,nh,data_type),src0=img_pyr.data[i<<2]),jsfeat.imgproc.resample(src,src0,nw,nh);for(i=this.next;i<this.scale_to+2*this.next;++i)src1=img_pyr.data[(i<<2)-(this.next<<2)],src0=img_pyr.data[i<<2],nw=src1.cols>>1,nh=src1.rows>>1,(new_pyr||nw!=src0.cols||nh!=src0.rows)&&(img_pyr.data[i<<2]=new jsfeat.matrix_t(nw,nh,data_type),src0=img_pyr.data[i<<2]),jsfeat.imgproc.pyrdown(src1,src0);for(i=2*this.next;i<this.scale_to+2*this.next;++i)src1=img_pyr.data[(i<<2)-(this.next<<2)],nw=src1.cols>>1,nh=src1.rows>>1,src0=img_pyr.data[(i<<2)+1],(new_pyr||nw!=src0.cols||nh!=src0.rows)&&(img_pyr.data[(i<<2)+1]=new jsfeat.matrix_t(nw,nh,data_type),src0=img_pyr.data[(i<<2)+1]),jsfeat.imgproc.pyrdown(src1,src0,1,0),src0=img_pyr.data[(i<<2)+2],(new_pyr||nw!=src0.cols||nh!=src0.rows)&&(img_pyr.data[(i<<2)+2]=new jsfeat.matrix_t(nw,nh,data_type),src0=img_pyr.data[(i<<2)+2]),jsfeat.imgproc.pyrdown(src1,src0,0,1),src0=img_pyr.data[(i<<2)+3],(new_pyr||nw!=src0.cols||nh!=src0.rows)&&(img_pyr.data[(i<<2)+3]=new jsfeat.matrix_t(nw,nh,data_type),src0=img_pyr.data[(i<<2)+3]),jsfeat.imgproc.pyrdown(src1,src0,1,1);return img_pyr},detect:function(pyramid,cascade){var alpha,feature,orig_feature,feature_k,feature_o,scale=(this.interval,this.scale),next=this.next,scale_upto=this.scale_to,i=0,j=0,k=0,n=0,x=0,y=0,q=0,sn=0,f_cnt=0,q_cnt=0,p=0,pmin=0,nmax=0,f=0,i4=0,qw=0,qh=0,sum=0,flag=!0,shortcut=!0,scale_x=1,scale_y=1,dx=[0,1,0,1],dy=[0,0,1,1],seq=[],pyr=pyramid.data,bpp=1,bpp2=2,bpp4=4,u8=[],u8o=[0,0,0],step=[0,0,0],paddings=[0,0,0];for(i=0;scale_upto>i;i++){for(i4=i<<2,qw=pyr[i4+(next<<3)].cols-(cascade.width>>2),qh=pyr[i4+(next<<3)].rows-(cascade.height>>2),step[0]=pyr[i4].cols*bpp,step[1]=pyr[i4+(next<<2)].cols*bpp,step[2]=pyr[i4+(next<<3)].cols*bpp,paddings[0]=pyr[i4].cols*bpp4-qw*bpp4,paddings[1]=pyr[i4+(next<<2)].cols*bpp2-qw*bpp2,paddings[2]=pyr[i4+(next<<3)].cols*bpp-qw*bpp,sn=cascade.stage_classifier.length,j=0;sn>j;j++)for(orig_feature=cascade.stage_classifier[j].feature,feature=cascade.stage_classifier[j]._feature,f_cnt=cascade.stage_classifier[j].count,k=0;f_cnt>k;k++)for(feature_k=feature[k],feature_o=orig_feature[k],q_cnt=0|feature_o.size,q=0;q_cnt>q;q++)feature_k.px[q]=feature_o.px[q]*bpp+feature_o.py[q]*step[feature_o.pz[q]],feature_k.pz[q]=feature_o.pz[q],feature_k.nx[q]=feature_o.nx[q]*bpp+feature_o.ny[q]*step[feature_o.nz[q]],feature_k.nz[q]=feature_o.nz[q];for(u8[0]=pyr[i4].data,u8[1]=pyr[i4+(next<<2)].data,q=0;4>q;q++)for(u8[2]=pyr[i4+(next<<3)+q].data,u8o[0]=dx[q]*bpp2+dy[q]*(pyr[i4].cols*bpp2),u8o[1]=dx[q]*bpp+dy[q]*(pyr[i4+(next<<2)].cols*bpp),u8o[2]=0,y=0;qh>y;y++){for(x=0;qw>x;x++){for(sum=0,flag=!0,sn=cascade.stage_classifier.length,j=0;sn>j;j++){for(sum=0,alpha=cascade.stage_classifier[j].alpha,feature=cascade.stage_classifier[j]._feature,f_cnt=cascade.stage_classifier[j].count,k=0;f_cnt>k;k++)if(feature_k=feature[k],pmin=u8[feature_k.pz[0]][u8o[feature_k.pz[0]]+feature_k.px[0]],nmax=u8[feature_k.nz[0]][u8o[feature_k.nz[0]]+feature_k.nx[0]],nmax>=pmin)sum+=alpha[k<<1];else{for(shortcut=!0,q_cnt=feature_k.size,f=1;q_cnt>f;f++){if(feature_k.pz[f]>=0&&(p=u8[feature_k.pz[f]][u8o[feature_k.pz[f]]+feature_k.px[f]],pmin>p)){if(nmax>=p){shortcut=!1;break}pmin=p}if(feature_k.nz[f]>=0&&(n=u8[feature_k.nz[f]][u8o[feature_k.nz[f]]+feature_k.nx[f]],n>nmax)){if(n>=pmin){shortcut=!1;break}nmax=n}}sum+=shortcut?alpha[(k<<1)+1]:alpha[k<<1]}if(sum<cascade.stage_classifier[j].threshold){flag=!1;break}}flag&&(seq.push({x:(4*x+2*dx[q])*scale_x,y:(4*y+2*dy[q])*scale_y,width:cascade.width*scale_x,height:cascade.height*scale_y,neighbor:1,confidence:sum}),++x,u8o[0]+=bpp4,u8o[1]+=bpp2,u8o[2]+=bpp),u8o[0]+=bpp4,u8o[1]+=bpp2,u8o[2]+=bpp}u8o[0]+=paddings[0],u8o[1]+=paddings[1],u8o[2]+=paddings[2]}scale_x*=scale,scale_y*=scale}return seq},group_rectangles:function(rects,min_neighbors){"undefined"==typeof min_neighbors&&(min_neighbors=1);var i,j,n=rects.length,node=[];for(i=0;n>i;++i)node[i]={parent:-1,element:rects[i],rank:0};for(i=0;n>i;++i)if(node[i].element){for(var root=i;-1!=node[root].parent;)root=node[root].parent;for(j=0;n>j;++j)if(i!=j&&node[j].element&&_group_func(node[i].element,node[j].element)){for(var root2=j;-1!=node[root2].parent;)root2=node[root2].parent;if(root2!=root){node[root].rank>node[root2].rank?node[root2].parent=root:(node[root].parent=root2,node[root].rank==node[root2].rank&&node[root2].rank++,root=root2);for(var temp,node2=j;-1!=node[node2].parent;)temp=node2,node2=node[node2].parent,node[temp].parent=root;for(node2=i;-1!=node[node2].parent;)temp=node2,node2=node[node2].parent,node[temp].parent=root}}}var idx_seq=[],class_idx=0;for(i=0;n>i;i++){j=-1;var node1=i;if(node[node1].element){for(;-1!=node[node1].parent;)node1=node[node1].parent;node[node1].rank>=0&&(node[node1].rank=~class_idx++),j=~node[node1].rank}idx_seq[i]=j}var comps=[];for(i=0;class_idx+1>i;++i)comps[i]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(i=0;n>i;++i){var r1=rects[i],idx=idx_seq[i];0==comps[idx].neighbors&&(comps[idx].confidence=r1.confidence),++comps[idx].neighbors,comps[idx].x+=r1.x,comps[idx].y+=r1.y,comps[idx].width+=r1.width,comps[idx].height+=r1.height,comps[idx].confidence=Math.max(comps[idx].confidence,r1.confidence)}var seq2=[];for(i=0;class_idx>i;++i)n=comps[i].neighbors,n>=min_neighbors&&seq2.push({x:(2*comps[i].x+n)/(2*n),y:(2*comps[i].y+n)/(2*n),width:(2*comps[i].width+n)/(2*n),height:(2*comps[i].height+n)/(2*n),neighbors:comps[i].neighbors,confidence:comps[i].confidence});var result_seq=[];for(n=seq2.length,i=0;n>i;++i){var r1=seq2[i],flag=!0;for(j=0;n>j;++j){var r2=seq2[j],distance=.25*r2.width+.5|0;if(i!=j&&r1.x>=r2.x-distance&&r1.y>=r2.y-distance&&r1.x+r1.width<=r2.x+r2.width+distance&&r1.y+r1.height<=r2.y+r2.height+distance&&(r2.neighbors>Math.max(3,r1.neighbors)||r1.neighbors<3)){flag=!1;break}}flag&&result_seq.push(r1)}return result_seq}}}();global.bbf=bbf}(jsfeat);